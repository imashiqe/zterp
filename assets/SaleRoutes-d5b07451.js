import{u as V,b as k,r as g,k as $,ch as Oe,j as e,L as G,bh as ce,s as Ie,o as Ae,ci as Ee,F as S,I as X,bm as xe,ce as oe,c1 as pe,B as se,P as he,e as je,cj as Ce,ck as De,w as _e,b$ as Be,c0 as Ne,be as Pe,bf as Ue,C as Te,N as He,a3 as Ge,cl as ye,q as We,cm as Ke,b5 as Je,b6 as Xe,b7 as Ze,cn as ke,bc as re,co as et,x as tt,y as U}from"./index-16ff5701.js";import{S as st,e as ie,d as at,I as lt,L as nt,b as rt,P as H}from"./AdminLayout-ac80ae52.js";import{d as E}from"./dayjs.min-72f12467.js";import{C as ae,U as Fe,T as Ye,b as dt,d as ot,c as it,a as ct,f as ut}from"./TableComponent-f70e0475.js";import{V as $e}from"./ViewBtn-eedc84ae.js";import{D as _}from"./index-f03f7796.js";import{i as Me}from"./invoiceGenerator-91e8874d.js";import{n as Qe}from"./numberToWords-4c291141.js";import{u as le}from"./useCurrency-ff395f2c.js";import{I as q}from"./index-6d01e873.js";import{S as T,g as mt,a as Z,r as xt,v as pt}from"./Button-81cb4f36.js";import{B as ue}from"./BigDrawer-5db64386.js";import{A as Re}from"./AddCustomer-1220d5e7.js";import{M as ht}from"./index-2e4f1652.js";import{A as jt}from"./AddTermsAndConditions-427e3fbf.js";import{R as yt}from"./ReportTable-1374d75d.js";import{S as bt,a as ft,b as gt,d as Nt,D as vt}from"./detailSale-a5103176.js";import{C as wt}from"./CreateButton-6e9825f1.js";import{a as St,b as It,c as At}from"./index-bad6c49c.js";import{a as te}from"./nFormetter-e5bcdc34.js";import{M as ve}from"./ModalUi-03657474.js";import"./index-8b1cef28.js";import"./useForceUpdate-5b1eefe7.js";import"./jspdf.es.min-3ec80e90.js";import"./UploadMany-ab6f4635.js";import"./index-1b45a375.js";import"./InfoCircleFilled-829db91a.js";import"./index-1ab3c210.js";import"./EditOutlined-f754bc7b.js";import"./fade-f955b557.js";import"./List-ddf690f6.js";import"./AddTransaction-47663915.js";import"./AddAccount-215a6d3d.js";import"./index-0daf2765.js";import"./DeleteOutlined-e1f8fe69.js";import"./index-4f6b3efe.js";import"./TagInput-4d878cae.js";import"./AddProduct-4dee3988.js";import"./addProductSubcategory-34015a86.js";import"./addProductCategory-004b5cd6.js";import"./AddUoM-ec811117.js";import"./AddDiscount-f6dfe087.js";import"./addProductBrand-7852dee3.js";import"./addVatTax-d5f3f099.js";import"./Collapse-d1408748.js";import"./index-5070a1ec.js";function Ct(){const s=V(),{list:o,total:m,loading:u}=k(n=>n.saleReturn),{RangePicker:a}=_,[f,i]=g.useState($().startOf("month").format("YYYY-MM-DD")),[N,j]=g.useState($().endOf("month").format("YYYY-MM-DD")),[c,d]=g.useState({page:1,count:10,status:"true"}),l=[{id:1,title:"ID",dataIndex:"id",key:"id",render:n=>e.jsx(G,{to:`/admin/sale-return-list/${n}`,children:n}),renderCsv:n=>n},{id:2,title:"Date",dataIndex:"date",key:"date",render:n=>$(n).format("ll"),renderCsv:n=>$(n).format("ll")},{id:3,title:"Sale Invoice Id",dataIndex:"saleInvoiceId",key:"saleInvoiceId"},{id:4,title:"Notes",dataIndex:"note",key:"note",render:n=>ce(n,20)},{id:5,title:"Action",dataIndex:"id",key:"id",render:n=>e.jsx("div",{className:"flex flex-row",children:e.jsx($e,{path:`/admin/sale-return-list/${n}`})}),csvOff:!0}];g.useEffect(()=>{s(Oe({status:!0,page:1,count:10,startDate:f,endDate:N}))},[s,N,f]);const t=n=>{const h=n[0].format("YYYY-MM-DD"),w=n[1].format("YYYY-MM-DD");i(h),j(w)};return e.jsx(ae,{className:"max-md:border-0 max-md:bg-white",bodyClass:"max-md:p-0 ",headClass:"border-none",title:"Sale Return ",extra:e.jsx(a,{onCalendarChange:t,defaultValue:[E(f,"YYYY-MM-DD"),E(N,"YYYY-MM-DD")],className:"range-picker",style:{maxWidth:"400px"}}),children:e.jsx(Fe,{permission:"readAll-returnSaleInvoice",children:e.jsx(Ye,{list:o,total:m,columns:l,loading:u,setPageConfig:d,query:{startdate:f,enddate:N},title:"Sale Return List"})})})}function Dt(){return e.jsx(e.Fragment,{children:e.jsx(Ct,{})})}function Pt({data:s,title:o}){var h,w,I,x;const{currencySymbol:m,currencyName:u}=le()||{},a=k(p=>{var v;return(v=p==null?void 0:p.setting)==null?void 0:v.data})||null,f=V(),i=[{value:`Customer: ${(w=(h=s==null?void 0:s.saleInvoice)==null?void 0:h.customer)!=null&&w.username?(x=(I=s==null?void 0:s.saleInvoice)==null?void 0:I.customer)==null?void 0:x.username:"-"}`},{value:`Sale Invoice Id: ${s!=null&&s.saleInvoiceId?s==null?void 0:s.saleInvoiceId:"-"}`}],N=[{value:`Invoice No: ${s!=null&&s.id?s==null?void 0:s.id:"-"}`},{value:`Invoice Date: ${$(s==null?void 0:s.date).format("YYYY-MM-DD")}`},{value:`currency : ${u}`}],c=[{label:"IN WORDS: ",value:`${Qe(Math.round(s.totalAmount+(s.tax?s.tax:0))).toUpperCase()} ${u}`||""},{label:"Terms And Conditions: ",value:s.termsAndConditions?s.termsAndConditions:""},{label:"Notes: ",value:s.note?s.note:""}],d=[{label:"Total:",value:`${s.totalAmount?s.totalAmount:0}`},{label:"Tax Amount:",value:`${s.tax?s.tax:0}`},{label:"Ground Total:",value:`${s.totalAmount+(s.tax?s.tax:0)}`}],l=["SI","Product Description","Quantity","Sale Price","Total Price","Total Tax"],t=s.returnSaleInvoiceProduct.map(p=>[p.id,p.product.name,p.productQuantity,`${p.productUnitSalePrice}`,`${p.productUnitSalePrice*p.productQuantity}`,`${p.taxAmount}`]),n={jsPDF:{},tableFontSize:10,infoTopFontSize:10,bottomRightFontSize:10,bottomLeftFontSize:8,footerFontSize:10};return g.useEffect(()=>{!a&&f(Ie())},[f,a]),e.jsx("div",{className:"",children:e.jsx("button",{className:"bg-primary cursor-pointer flex justify-center items-center px-4 py-[10px] text-white rounded",onClick:()=>Me("print",{title:o,TopRightInfo:N,companyInfo:a,customerInfo:i,bottomLeftContent:c,bottomRightContent:d,tableBody:t,tableHead:l,settings:n,leftBottomSecondColumnX:32}),children:"Print Invoice"})})}function Tt(){const s=V(),{id:o}=Ae(),[m,u]=g.useState([]),{returnSale:a,loading:f}=k(c=>c.saleReturn),i=[{id:1,title:"ID",dataIndex:"id",key:"id"},{id:2,title:"Product Name",dataIndex:"product",key:"product",render:c=>e.jsx(G,{to:`/admin/product/${c==null?void 0:c.id}`,children:c==null?void 0:c.name})},{id:3,title:"Date",dataIndex:"createdAt",key:"date",render:c=>$(c).format("ll")},{id:4,title:"Product Quantity",dataIndex:"productQuantity",key:"productQuantity"},{id:5,title:"Sale Price",dataIndex:"productFinalAmount",key:"productUnitSalePrice"},{id:5,title:"Total Tax",dataIndex:"taxAmount",key:"taxAmount"}];g.useEffect(()=>{u(i),s(Ee(o))},[]);const N=c=>{u(c)},j=c=>c==null?void 0:c.map(d=>({...d,key:d.id}));return e.jsx(e.Fragment,{children:e.jsxs(ae,{className:"header-solid h-full",bordered:!1,title:e.jsxs("h5",{className:"flex items-center",children:[e.jsx(st,{}),e.jsxs("span",{className:"mr-left",children:["ID : ",o]})]}),bodyStyle:{paddingTop:"0"},extra:e.jsx("div",{className:"flex gap-2",children:a&&e.jsx(Pt,{title:"Sale Return Invoice",data:a})}),children:[e.jsx("div",{className:"text-[18px] font-medium flex justify-center",children:"Sale Return Product Information"}),a&&e.jsx("div",{children:e.jsxs("div",{className:"flex justify-between my-3",children:[e.jsx(dt,{options:i,columns:i,columnsToShowHandler:N}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"bg-gray-100 px-2 py-1 rounded-sm m-1",children:["Sale Invoice Id: ",a==null?void 0:a.saleInvoiceId]}),e.jsxs("div",{className:"bg-gray-100 px-2 py-1 rounded-sm m-1",children:["Date: ",$(a==null?void 0:a.createdAt).format("ll")]})]})]})}),e.jsx("div",{className:"mb-5",children:e.jsx(ot,{scroll:{x:!0},loading:!a,columns:m,data:a?j(a==null?void 0:a.returnSaleInvoiceProduct):[]})}),e.jsxs("div",{className:"font-bold text-[16px]",children:["Total Return Amount:"," ",(a==null?void 0:a.totalAmount)+((a==null?void 0:a.tax)||0)]}),e.jsxs("h6",{className:" m-0 max-w-[500px] py-2",children:[e.jsx("span",{className:"font-bold",children:"Return Note:"}),e.jsxs("span",{className:"font-medium",children:[" ",a==null?void 0:a.note]})," "]})]})})}function kt({totalCalculator:s,subTotal:o,form:m,selectedProduct:u,setSelectedProduct:a}){const f=le(),i=j=>{var h,w,I,x;const c=(w=(h=m.getFieldValue("saleInvoiceProduct"))==null?void 0:h.find((p,v)=>v===j))==null?void 0:w.productId,d=u==null?void 0:u.find(p=>c===p.id);let l=null;Array.isArray(d==null?void 0:d.productColor)&&d.productColor.length>0&&(l=e.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.jsx("span",{className:"mr-1",children:"Color: "}),d.productColor.map((p,v)=>{var y;return e.jsxs("span",{children:[(y=p.color)==null?void 0:y.name,v!==d.productColor.length-1&&","]},p.id)})]}));let t=null;d!=null&&d.productQuantity&&(t=e.jsxs("span",{children:[e.jsx("span",{className:"mr-1",children:"Stock: "}),e.jsx("span",{children:d.productQuantity})]}));let n=null;return(I=d==null?void 0:d.uom)!=null&&I.name&&(n=e.jsxs("span",{children:[e.jsx("span",{className:"mr-1",children:"UoM: "}),e.jsx("span",{children:`${d==null?void 0:d.uomValue}/${(x=d==null?void 0:d.uom)==null?void 0:x.name}`})]})),{stock:t,colors:l,uom:n,id:d==null?void 0:d.id}},N=j=>{a(c=>c.filter(d=>d.id!==j))};return e.jsx("div",{className:"products-container",children:e.jsx(S.List,{name:"saleInvoiceProduct",rules:[{required:!0,message:"Product is required"}],children:(j,{remove:c})=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"max-h-[calc(100vh-280px)] overflow-auto mt-2",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"font-Popins text-black bg-tableHeaderBg border-gray-200 sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 pl-2 text-left rounded-tl-lg",children:"SL"}),e.jsx("th",{className:"py-2 pl-2 text-left",children:"Product"}),e.jsx("th",{className:"py-2 pl-2 text-left",children:"Quantity"}),e.jsx("th",{className:"py-2 pl-2 text-left",children:"price"}),e.jsx("th",{className:"py-2 pl-2 text-left",children:"Discount"}),e.jsx("th",{className:"py-2 pl-2 text-left",children:"Amount"}),e.jsx("th",{className:"py-2 pl-2 text-left",children:"Tax%"}),e.jsx("th",{className:"py-2 pl-2 text-left",children:"Tax"}),e.jsx("th",{className:"py-2 pl-2 text-left rounded-tr-lg"})]})}),e.jsx("tbody",{className:"bg-tableBg px-1",children:j.map(({key:d,name:l,...t},n)=>{var w,I,x,p;const h=i(n);return e.jsxs("tr",{className:`hover:bg-slate-900/10 py-1 ${n===j.length-1?"":"border-b"}`,children:[e.jsx("td",{className:"py-2 pl-2 align-top",children:n+1}),e.jsxs("td",{className:"py-2 pl-2 align-top",children:[e.jsx(S.Item,{...t,name:[l,"productName"],className:"mb-0",children:e.jsx(X,{disabled:!0})}),e.jsx("div",{className:"px-2 text-xs whitespace-nowrap",children:h.uom})]}),e.jsxs("td",{className:"py-2 pl-2 align-top",children:[e.jsx(S.Item,{...t,name:[l,"productQuantity"],className:"mb-0",rules:[{required:!0,message:"quantity is required"}],children:e.jsx(q,{style:{width:"100%"},size:"small",placeholder:"Quantity",onChange:()=>s(n)})}),e.jsx("div",{className:"px-2 text-xs",children:h.stock})]}),e.jsx("td",{className:"py-2 pl-2 align-top",children:e.jsx(S.Item,{...t,name:[l,"productSalePrice"],className:"mb-0",rules:[{required:!0,message:"Price is required"}],children:e.jsx(q,{size:"small",style:{width:"100%"},placeholder:"50000",onChange:()=>s(n)})})}),e.jsx("td",{className:"py-2 pl-2 align-top",children:e.jsx("div",{className:"flex items-center",children:e.jsx(S.Item,{...t,name:[l,"productDiscount"],className:"mb-0 max-w-[150px]",rules:[{required:!0,message:"Discount is required"}],children:e.jsx(q,{className:"discountType",addonAfter:e.jsx(S.Item,{...t,name:[l,"discountType"],noStyle:!0,children:e.jsxs(T,{size:"small",style:{width:50},defaultValue:"flat",popupClassName:"bg-white",onChange:()=>s(n),children:[e.jsx(T.Option,{children:e.jsx("span",{dangerouslySetInnerHTML:{__html:f==null?void 0:f.currencySymbol}})},"flat"),e.jsx(T.Option,{children:"%"},"percentage")]})}),placeholder:"0",style:{width:"100%"},size:"small",onChange:()=>s(n)})})})}),e.jsx("td",{className:"py-2 pl-2 align-top min-w-[80px]",children:e.jsx("div",{className:"font-weight-bold md:text-base xxs:text-xs",children:((I=(w=o[n])==null?void 0:w.subPrice)==null?void 0:I.toFixed(2))||0})}),e.jsx("td",{className:"py-2 pl-2 align-top min-w-[80px]",children:e.jsx(S.Item,{...t,name:[l,"productVat"],className:"mb-0 max-w-[100px]",rules:[{required:!0,message:"Tax is required"}],children:e.jsx(q,{size:"small",style:{width:"100%"},placeholder:"50000",onChange:()=>s(n)})})}),e.jsx("td",{className:"py-2 pl-2 align-top min-w-[80px]",children:e.jsx("div",{className:"font-weight-bold md:text-base xxs:text-xs",children:((p=(x=o[n])==null?void 0:x.subVatAmount)==null?void 0:p.toFixed(2))||0})}),e.jsx("td",{className:"py-2 pl-2 align-top",children:e.jsx(S.Item,{className:"mb-0",children:e.jsx("button",{shape:"circle",className:"flex justify-center items-center hover:bg-black/40 rounded-md",onClick:()=>{N(h.id),c(l),s()},children:e.jsx(ie,{size:25})})})})]},d)})})]})}),j.length===0&&e.jsx("div",{className:"text-center py-10",children:"No product selected yet"})]})})})}const Ft=({form:s,subTotal:o,setIsModalOpen:m,totalCalculator:u,setSelectedProduct:a,selectedProduct:f})=>{const{Option:i}=T,N=V(),j=k(d=>d.customers.list),c=async()=>{m(!0)};return g.useEffect(()=>{N(xe()),N(oe({query:"all"}))},[N]),e.jsxs(S,{form:s,className:"m-lg-1",onFinish:c,name:"dynamic_form_nest_item",layout:"vertical",size:"large",autoComplete:"off",initialValues:{date:E()},onKeyDown:d=>{d.key==="Enter"&&d.preventDefault()},children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-3 mb-3 lg:mb-5",children:[e.jsx("div",{className:"w-full md:w-1/2",children:e.jsx(S.Item,{style:{marginBottom:"-10px"},label:e.jsxs(e.Fragment,{children:["Customer",e.jsx(ue,{className:"",title:"new Customer",children:e.jsx(Re,{drawer:!0})})]}),className:"w-full",name:"customerId",rules:[{required:!0,message:"Please Select a Customer!"}],children:e.jsx(T,{className:"w-full",loading:!j,showSearch:!0,placeholder:"Select a customer ",optionFilterProp:"children",filterOption:(d,l)=>l.children.toString().toLowerCase().includes(d.toLowerCase()),children:j&&j.map(d=>e.jsx(i,{value:d.id,children:d.username},d.id))})})}),e.jsx("div",{className:"w-full md:w-1/2",children:e.jsx(S.Item,{label:"Date",name:"date",className:"w-full",style:{marginBottom:"-10px"},rules:[{required:!0,message:"Please input Date!"}],required:!0,children:e.jsx(_,{})})})]}),e.jsx(kt,{subTotal:o,setSelectedProduct:a,selectedProduct:f,form:s,totalCalculator:u})]})};function Yt({totalCalculator:s}){const o=V(),{list:m,loading:u}=k(a=>a.accounts);return g.useEffect(()=>{o(pe())},[o]),e.jsx(S.List,{name:"paidAmount",children:(a,{add:f,remove:i})=>e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"bg-tableBg",children:a.map(({key:N,name:j,...c},d)=>e.jsx("div",{className:" py-1 ",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(S.Item,{...c,name:[j,"amount"],className:"mb-0",rules:[{required:!0,message:"Amount is required"}],children:e.jsx(q,{className:"discountType",addonAfter:e.jsx(S.Item,{...c,name:[j,"paymentType"],noStyle:!0,rules:[{required:!0,message:"Payment type is required"}],children:e.jsx(T,{loading:u,size:"small",popupClassName:"min-w-[200px]",style:{width:100},placeholder:"Select Payment type",optionFilterProp:"children",filterOption:(l,t)=>t.children.includes(l),filterSort:(l,t)=>l.children.toLowerCase().localeCompare(t.children.toLowerCase()),children:m==null?void 0:m.map(l=>e.jsx(T.Option,{value:l.id,children:l.name},l.id))})}),placeholder:"0",style:{width:"100%"},size:"small",onChange:()=>s&&s(d)})}),e.jsx("button",{shape:"circle",className:"flex justify-center items-center hover:bg-black/40 rounded-md",onClick:()=>{i(j),s&&s(d)},children:e.jsx(ie,{size:25})})]})},N))}),e.jsx("div",{className:"flex items-center justify-center mt-2",children:e.jsx(se,{type:"dashed",size:"small",onClick:()=>f(),className:"flex items-center justify-center",block:!0,icon:e.jsx(he,{}),children:"Add Payment"})})]})})}function $t({isModalOpen:s,setIsModalOpen:o,form:m,totalTaxAmount:u,total:a,totalPayable:f,totalDiscount:i,totalCalculator:N,due:j,productForm:c}){const d=je(),l=V(),[t,n]=g.useState(),{list:h,loading:w}=k(p=>p.termsAndConditions),I=localStorage.getItem("id"),x=async p=>{var v,y,C;try{const F=(v=c==null?void 0:c.getFieldValue("saleInvoiceProduct"))==null?void 0:v.map(A=>{const L=(A==null?void 0:A.productQuantity)||0,O=(A==null?void 0:A.productSalePrice)||0,r={productId:A.productId,productQuantity:A.productQuantity,productUnitSalePrice:A.productSalePrice,tax:A.productVat};return r.productDiscount=A.productDiscount,A.discountType==="percentage"&&(r.productDiscount=O*L*(A==null?void 0:A.productDiscount)/100),r}),Q={...p,customerId:c.getFieldValue("customerId"),date:c.getFieldValue("date"),paidAmount:p.paidAmount||[],saleInvoiceProduct:F,userId:parseInt(I)},R=await l(De(Q));R.payload.message==="success"&&(m.resetFields(),d(`/admin/sale/${(C=(y=R.payload)==null?void 0:y.data)==null?void 0:C.id}`))}catch{}};return g.useEffect(()=>{l(Ce()),l(pe())},[l]),e.jsx(e.Fragment,{children:e.jsx(ht,{title:"Sale",open:s,footer:!1,onCancel:()=>o(!1),children:e.jsxs(S,{form:m,className:"m-lg-1",onFinish:x,name:"dynamic_form_nest_item",initialValues:{discount:0,paidAmount:0,vatId:[]},onKeyDown:p=>{p.key==="Enter"&&p.preventDefault()},layout:"vertical",size:"large",autoComplete:"off",children:[e.jsx(S.Item,{className:"mb-0",label:"Due Date",name:"dueDate",children:e.jsx(_,{className:"",size:"small",placeholder:"Due Date"})}),e.jsx(S.Item,{className:"mb-0",label:e.jsxs(e.Fragment,{children:["Terms and conditions",t&&e.jsx("button",{onClick:()=>n(!1),className:"py-1 px-2 bg-red-200 rounded ml-1 text-gray-500",children:"Cancel"})]}),name:"termsAndConditions",children:t?e.jsx(X.TextArea,{onChange:p=>n(p),value:t}):e.jsx(T,{className:"w-full",loading:w,showSearch:!0,placeholder:"Select Terms and conditions",onSelect:p=>n(p),children:h&&(h==null?void 0:h.map(p=>e.jsx(T.Option,{value:p.subject,children:p.title},p.id)))})}),e.jsxs("div",{className:"flex justify-between py-2",children:[e.jsx("strong",{children:"Total amount: "}),e.jsx("strong",{children:a.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between py-2",children:[e.jsx("span",{children:"Total discount: "}),e.jsx("span",{children:Number(i).toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between py-2",children:[e.jsx("span",{children:"Total tax amount: "}),e.jsx("span",{children:u.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between py-2",children:[e.jsx("strong",{children:"Total payable: "}),e.jsx("strong",{children:f.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between py-2",children:[e.jsx("strong",{children:"Due: "}),e.jsx("strong",{children:j.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between py-2",children:[e.jsx("span",{children:"Paid Amount: "}),e.jsx(Yt,{totalCalculator:N})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx(S.Item,{className:"w-full mb-0",children:e.jsx(se,{block:!0,type:"primary",htmlType:"submit",children:"Sale Now"})})})]})})})}function Ve({className:s,form:o,totalCalculator:m,setSelectedProduct:u}){const a=V(),[f,i]=g.useState(""),N=g.useRef(null),{list:j}=k(t=>t.productSearch),c=t=>{var w,I,x,p;const n=o.getFieldValue("saleInvoiceProduct")||[];if(n.find(v=>v.productId===t.id)){const v=n.map(y=>t.id===y.productId?{...y,productQuantity:y.productQuantity?y.productQuantity+1:1}:y);o.setFieldsValue({saleInvoiceProduct:v})}else u&&u(v=>[...v,t]),o.setFieldsValue({saleInvoiceProduct:[...n,{productId:t.id,productName:t.name,productQuantity:u?1:0,productSalePrice:t.productSalePrice,productVat:t.productVat?(w=t.productVat)==null?void 0:w.percentage:0,productDiscount:(I=t.discount)!=null&&I.value?parseInt((x=t.discount)==null?void 0:x.value):0,discountType:((p=t.discount)==null?void 0:p.type)||"flat"}]});m()},d=async t=>{N.current&&clearTimeout(N.current),i(t.target.value),N.current=setTimeout(async()=>{var n,h,w,I,x;if(t.target.value!==""){const p=await a(Be({query:"search",key:t.target.value,count:7}));((w=(h=(n=p.payload)==null?void 0:n.data)==null?void 0:h.getAllProduct)==null?void 0:w.length)===1&&(c((x=(I=p.payload)==null?void 0:I.data)==null?void 0:x.getAllProduct[0]),l())}else a(Ne())},500)},l=()=>{f!==""&&(i(""),a(Ne()))};return g.useEffect(()=>()=>{l()},[]),e.jsxs("div",{className:_e("relative w-full ",{[s]:s}),children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:f,onChange:d,className:`w-full py-2 px-5 rounded-lg outline-0 ${(j==null?void 0:j.length)>0&&"rounded-b-none"}`,placeholder:"Search Product"}),f&&e.jsx("button",{type:"button",onClick:l,className:"text-black/50 absolute  right-8 h-full pl-2 pr-4 z-10 ",children:e.jsx(at,{size:25})}),e.jsx("button",{type:"button",className:"text-gray-400 absolute  right-0 h-full pl-2 pr-4 z-10 ",children:e.jsx(lt,{size:25})})]}),(j==null?void 0:j.length)>0&&e.jsx("div",{className:"absolute bg-white shadow-md z-20 w-full rounded-b-lg max-h-80 md:max-h-[600px] overflow-y-auto ",children:j.map(t=>e.jsx(Mt,{onSelect:c,product:t,handleClear:l},t.id))})]})}function Mt({product:s,onSelect:o,handleClear:m}){const{name:u,productQuantity:a}=s;return e.jsxs("div",{onClick:()=>{o(s),m()},className:"flex justify-between items-center gap-2 py-1 w-full px-5 hover:bg-slate-950/10 text-sm",children:[e.jsx("div",{className:"flex items-center gap-3 justify-start",children:e.jsx("h1",{className:"font-medium text-gray-700",children:u})}),e.jsx("div",{className:"",children:a>0?e.jsxs("span",{className:"bg-green-500/10 text-green-700 rounded px-2 flex gap-2",children:["Stock: ",e.jsx("span",{children:a})]}):e.jsx("span",{className:"bg-red-500/10 text-red-700 rounded px-2",children:"Stock out"})})]})}function Qt({form:s,totalCalculator:o,setSelectedProduct:m}){const u=V(),[a,f]=g.useState({page:1,count:10,status:"true"}),{list:i,total:N,loading:j}=k(t=>t.products);k(t=>t.productSubCategories);const c=(t,n)=>{f(h=>({...h,page:t,count:n}))};g.useEffect(()=>{u(Pe(a)),u(Ue({page:1,count:100,status:!0}))},[u,a]);const d=t=>{var w,I,x,p;const n=s.getFieldValue("saleInvoiceProduct")||[],h=n.find(v=>v.productId===t.id);if(!h)m(v=>[...v,t]),s.setFieldsValue({saleInvoiceProduct:[...n,{productId:t.id,productSalePrice:t.productSalePrice,productQuantity:t.productQuantity?1:0,productName:t.name,productVat:t.productVat?(w=t.productVat)==null?void 0:w.percentage:0,productDiscount:(I=t.discount)!=null&&I.value?parseInt((x=t.discount)==null?void 0:x.value):0,discountType:((p=t.discount)==null?void 0:p.type)||"flat"}]}),o();else if(h){const v=n==null?void 0:n.map(y=>y.productId===t.id?{...y,productQuantity:y.productQuantity+1}:y);s.setFieldsValue({saleInvoiceProduct:v})}o()},l=({item:t,index:n})=>{const h=w=>{w.target.src="/images/default.jpg"};return e.jsx(Te,{style:{width:"100%",border:"none",height:"120px"},bodyStyle:{backgroundColor:"white",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",height:"120px"},className:"relative  bg-white hover:bg-white hover:shadow-md duration-150 overflow-hidden cursor-pointer",onClick:()=>{d(t)},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-[80px] h-[44px] relative",children:e.jsx("img",{alt:"example",className:"absolute object-cover w-full h-full",src:t.productThumbnailImageUrl||"",onError:h,style:{width:"100%",height:"auto"}})}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("p",{className:"font-bold mb-0",children:ce(t.name,20)}),e.jsxs("p",{className:"mb-0",style:{fontSize:"12px"},children:["Price : ",t.productSalePrice]}),e.jsxs("p",{className:`${t.productQuantity?"bg-violet-600":"bg-red-600"} text-white p-1 absolute top-0 left-0`,style:{fontSize:"12px"},children:["QTY: ",t.productQuantity||0]}),e.jsxs("p",{style:{fontSize:"12px"},children:[" ","SKU : ",ce(t.sku,10)]})]})]})})};return e.jsxs("div",{className:"flex flex-col max-h-[200px] lg:max-h-[calc(100vh-180px)] overflow-y-auto",children:[e.jsx("div",{className:"flex flex-col md:flex-row justify-around items-center gap-3 pb-3 lg:pb-0",children:e.jsx(Ve,{className:"w-full mt-4 mx-2",form:s,totalCalculator:o,setSelectedProduct:m})}),e.jsx("div",{className:"hidden lg:grid flex-grow  grid-cols-1 lg:grid-cols-2 3xl:grid-cols-3 gap-2 mt-5",children:i?i.map((t,n)=>e.jsx(l,{index:n,item:t},n)):j&&e.jsx("div",{className:"w-100 flex justify-center items-center",children:e.jsx(mt,{size:"large"})})}),e.jsx("div",{className:"hidden lg:block",children:N>=11&&e.jsx("div",{className:"mt-4",children:e.jsx(it,{onChange:c,total:N})})})]})}const Rt=s=>{const o=!!localStorage.getItem("isLogged"),[m]=S.useForm(),u=S.useForm()[0],a=V(),[f,i]=g.useState([]),[N,j]=g.useState([]),[c,d]=g.useState(0),[l,t]=g.useState(!1),{list:n,loading:h}=k(y=>y.vatTax);if(g.useEffect(()=>{a(xe())},[a]),!o)return e.jsx(He,{to:"/auth/login",replace:!0});const w=()=>{const y=m.getFieldValue("saleInvoiceProduct"),C=(y==null?void 0:y.reduce((r,D)=>{const b=(D==null?void 0:D.productQuantity)||0,M=(D==null?void 0:D.productSalePrice)||0;let K=(D==null?void 0:D.productDiscount)||0;(D==null?void 0:D.discountType)==="percentage"&&(K=M*b*(D==null?void 0:D.productDiscount)/100);const ee=(D==null?void 0:D.productVat)||0,J=M*b-K,B=ee/100*J;return[...r,{subDiscount:K,subVatAmount:B,subPrice:J}]},[]))||[];j(C);const F=C.reduce((r,D)=>r+D.subPrice,0),Q=C.reduce((r,D)=>r+D.subVatAmount,0),R=F+Q,A=u.getFieldValue("paidAmount")||[],L=A==null?void 0:A.reduce((r,D)=>r+(D.amount?parseInt(D.amount):0),0),O=R-L;d(O)},I=N.reduce((y,C)=>y+C.subPrice,0),x=N.reduce((y,C)=>y+C.subVatAmount,0),p=N.reduce((y,C)=>y+C.subDiscount,0),v=I+x;return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"h-full min-h-[calc(100vh-160px)] relative pb-2",children:[e.jsxs("div",{className:"flex flex-col xl:flex-row gap-3 h-full",children:[e.jsx("div",{className:"2xl:w-2/5  xl:w-1/2 p-2 bg-[#F1F1F1] h-full",children:e.jsx(Qt,{setSelectedProduct:i,form:m,totalCalculator:w})}),e.jsx("div",{className:"2xl:w-3/5 xl:w-1/2 p-5",children:e.jsx(Ft,{form:m,setSelectedProduct:i,selectedProduct:f,totalCalculator:w,subTotal:N,setIsModalOpen:t})})]}),e.jsx($t,{form:u,isModalOpen:l,productForm:m,setIsModalOpen:t,due:c,total:I,totalPayable:v,totalTaxAmount:x,totalDiscount:p,totalCalculator:w,vatTaxList:n,vatTaxLoading:h})]}),e.jsx("div",{className:"sticky bottom-0 right-0 w-full  border rounded bg-white p-2 px-5 mt-3 z-10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium md:font-semibold text-lg",children:"Net Total"}),":"," ",e.jsx("span",{className:"font-bold text-base lg:text-xl",children:v.toFixed(3)})]}),e.jsx("div",{children:e.jsx(se,{onClick:()=>m.submit(),type:"primary",children:e.jsx("strong",{children:"Continue Sale"})})})]})})]})},Vt=Rt;function zt({form:s,productList:o,productLoading:m,totalCalculator:u,subTotal:a}){const f=le(),i=(j,c)=>{const d=s.getFieldValue("saleInvoiceProduct"),l=o.find(n=>n.id===j);l.productQuantity===0&&Ge.error("Product is out of stock");const t=d.map((n,h)=>{var w,I,x;return h===c?{...n,productQuantity:l.productQuantity?1:0,productSalePrice:l.productSalePrice,productVat:l.productVat?l.productVat.percentage:0,productDiscount:(w=l.discount)!=null&&w.value?parseInt((I=l.discount)==null?void 0:I.value):0,discountType:((x=l.discount)==null?void 0:x.type)||"flat"}:n});s.setFieldsValue({saleInvoiceProduct:t}),u()},N=j=>{var h,w,I,x;const c=(w=(h=s.getFieldValue("saleInvoiceProduct"))==null?void 0:h.find((p,v)=>v===j))==null?void 0:w.productId,d=o==null?void 0:o.find(p=>c===p.id);let l=null;Array.isArray(d==null?void 0:d.productColor)&&d.productColor.length>0&&(l=e.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.jsx("span",{className:"mr-1",children:"Color: "}),d.productColor.map((p,v)=>{var y;return e.jsxs("span",{children:[(y=p.color)==null?void 0:y.name,v!==d.productColor.length-1&&","]},p.id)})]}));let t=null;d!=null&&d.productQuantity&&(t=e.jsxs("span",{children:[e.jsx("span",{className:"mr-1",children:"Stock: "}),e.jsx("span",{children:d.productQuantity})]}));let n=null;return(I=d==null?void 0:d.uom)!=null&&I.name&&(n=e.jsxs("span",{children:[e.jsx("span",{className:"mr-1",children:"UoM: "}),e.jsx("span",{children:`${d==null?void 0:d.uomValue}/${(x=d==null?void 0:d.uom)==null?void 0:x.name}`})]})),{stock:t,colors:l,uom:n}};return e.jsx(ae,{className:"h-[calc(100vh-100px)]",headClass:"",bodyClass:"p-0",title:e.jsx(Ve,{className:"w-[450px]",form:s,totalCalculator:u}),children:e.jsx(S.List,{name:"saleInvoiceProduct",rules:[{required:!0,message:"Product is required"}],children:(j,{add:c,remove:d})=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"max-h-[calc(100vh-220px)] overflow-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"font-Popins text-black bg-tableHeaderBg border-gray-200 sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 pl-2 text-left",children:"SL"}),e.jsx("th",{className:"py-2 pl-2 text-left",children:"Product"}),e.jsx("th",{className:"py-2 pl-2 text-left",children:"Quantity"}),e.jsx("th",{className:"py-2 pl-2 text-left",children:"Price"}),e.jsx("th",{className:"py-2 pl-2 text-left",children:"Discount"}),e.jsx("th",{className:"py-2 pl-2 text-left",children:"Amount"}),e.jsx("th",{className:"py-2 pl-2 text-left",children:"Tax%"}),e.jsx("th",{className:"py-2 pl-2 text-left",children:"Tax"}),e.jsx("th",{className:"py-2 pl-2 text-left"})]})}),e.jsx("tbody",{className:"bg-tableBg",children:j.map(({key:l,name:t,...n},h)=>{var I,x,p,v;const w=N(h);return e.jsxs("tr",{className:`hover:bg-slate-900/10 py-1 ${h===j.length-1?"":"border-b"}`,children:[e.jsx("td",{className:"py-2 pl-2  align-top",children:h+1}),e.jsxs("td",{className:"py-2 pl-2 align-top",children:[e.jsx(S.Item,{...n,name:[t,"productId"],className:"mb-0 max-w-[250px]",rules:[{required:!0,message:"Product is required"}],children:e.jsx(T,{placeholder:"Select Product",showSearch:!0,loading:m,optionFilterProp:"children",filterOption:(y,C)=>C.children.toLowerCase().includes(y.toLowerCase()),onChange:y=>{i(y,h)},children:o==null?void 0:o.map(y=>e.jsx(T.Option,{value:y.id,children:y.name},y.id))})}),e.jsx("div",{className:"px-2",children:w.colors}),e.jsx("div",{className:"px-2",children:w.uom})]}),e.jsxs("td",{className:"py-2 pl-2 align-top",children:[e.jsx(S.Item,{...n,name:[t,"productQuantity"],className:"mb-0 max-w-[100px]",rules:[{required:!0,message:"quantity is required"}],children:e.jsx(q,{type:"number",style:{width:"100%"},size:"small",placeholder:"Quantity",onChange:()=>u(h)})}),e.jsx("div",{children:w.stock})]}),e.jsx("td",{className:"py-2 pl-2 align-top",children:e.jsx(S.Item,{...n,name:[t,"productSalePrice"],className:"mb-0 max-w-[150px]",rules:[{required:!0,message:"Price is required"}],children:e.jsx(q,{type:"number",size:"small",style:{width:"100%"},placeholder:"50000",onChange:()=>u(h)})})}),e.jsx("td",{className:"py-2 pl-2 align-top",children:e.jsx("div",{className:"flex items-center",children:e.jsx(S.Item,{...n,name:[t,"productDiscount"],className:"mb-0 max-w-[150px]",rules:[{required:!0,message:"Discount is required"}],children:e.jsx(q,{type:"number",className:"discountType",addonAfter:e.jsx(S.Item,{...n,name:[t,"discountType"],noStyle:!0,children:e.jsxs(T,{size:"small",style:{width:50},defaultValue:"flat",popupClassName:"bg-white",onChange:()=>u(h),children:[e.jsx(T.Option,{children:e.jsx("span",{dangerouslySetInnerHTML:{__html:f==null?void 0:f.currencySymbol}})},"flat"),e.jsx(T.Option,{children:"%"},"percentage")]})}),placeholder:"0",style:{width:"100%"},size:"small",onChange:()=>u(h)})})})}),e.jsx("td",{className:"py-2 pl-2 align-top min-w-[80px]",children:e.jsx("div",{className:"font-weight-bold md:text-base xxs:text-xs",children:((x=(I=a[h])==null?void 0:I.subPrice)==null?void 0:x.toFixed(2))||0})}),e.jsx("td",{className:"py-2 pl-2 align-top min-w-[80px]",children:e.jsx(S.Item,{...n,name:[t,"productVat"],className:"mb-0 max-w-[100px]",rules:[{required:!0,message:"Tax is required"}],children:e.jsx(q,{type:"number",size:"small",style:{width:"100%"},placeholder:"50000",onChange:()=>u(h)})})}),e.jsx("td",{className:"py-2 pl-2 align-top min-w-[80px]",children:e.jsx("div",{className:"font-weight-bold md:text-base xxs:text-xs",children:((v=(p=a[h])==null?void 0:p.subVatAmount)==null?void 0:v.toFixed(2))||0})}),e.jsx("td",{className:"py-2 pl-2 align-top",children:e.jsx(S.Item,{children:e.jsx("button",{shape:"circle",className:"flex justify-center items-center hover:bg-black/40 rounded-md",onClick:()=>{d(t),u(h)},children:e.jsx(ie,{size:25})})})})]},l)})})]})}),j.length===0&&e.jsx("div",{className:"text-center py-10",children:"No product selected yet"}),e.jsx("div",{className:"flex items-center justify-center mt-2",children:e.jsx(Z,{onClick:()=>c(),className:"flex items-center justify-center w-48",block:!0,icon:e.jsx(he,{}),children:"Add Product"})})]})})})}function me(s){this.message=s}me.prototype=new Error,me.prototype.name="InvalidCharacterError";var we=typeof window<"u"&&window.atob&&window.atob.bind(window)||function(s){var o=String(s).replace(/=+$/,"");if(o.length%4==1)throw new me("'atob' failed: The string to be decoded is not correctly encoded.");for(var m,u,a=0,f=0,i="";u=o.charAt(f++);~u&&(m=a%4?64*m+u:u,a++%4)?i+=String.fromCharCode(255&m>>(-2*a&6)):0)u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(u);return i};function qt(s){var o=s.replace(/-/g,"+").replace(/_/g,"/");switch(o.length%4){case 0:break;case 2:o+="==";break;case 3:o+="=";break;default:throw"Illegal base64url string!"}try{return function(m){return decodeURIComponent(we(m).replace(/(.)/g,function(u,a){var f=a.charCodeAt(0).toString(16).toUpperCase();return f.length<2&&(f="0"+f),"%"+f}))}(o)}catch{return we(o)}}function de(s){this.message=s}function Lt(s,o){if(typeof s!="string")throw new de("Invalid token specified");var m=(o=o||{}).header===!0?0:1;try{return JSON.parse(qt(s.split(".")[m]))}catch(u){throw new de("Invalid token specified: "+u.message)}}de.prototype=new Error,de.prototype.name="InvalidTokenError";const Ot=()=>{var o;const s=localStorage.getItem("access-token");if(s)return(o=Lt(s))==null?void 0:o.sub};function ze({totalCalculator:s}){const o=V(),{list:m,loading:u}=k(a=>a.accounts);return g.useEffect(()=>{o(pe())},[o]),e.jsx(S.List,{name:"paidAmount",children:(a,{add:f,remove:i})=>e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"bg-tableBg",children:a.map(({key:N,name:j,...c},d)=>e.jsx("div",{className:" py-1 ",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(S.Item,{...c,name:[j,"amount"],className:"mb-0",rules:[{required:!0,message:"Amount is required"}],children:e.jsx(q,{className:"discountType",addonAfter:e.jsx(S.Item,{...c,name:[j,"paymentType"],noStyle:!0,rules:[{required:!0,message:"Payment type is required"}],children:e.jsx(T,{loading:u,size:"small",popupClassName:"min-w-[200px]",style:{width:100},placeholder:"Select Payment type",optionFilterProp:"children",filterOption:(l,t)=>t.children.includes(l),filterSort:(l,t)=>l.children.toLowerCase().localeCompare(t.children.toLowerCase()),children:m==null?void 0:m.map(l=>e.jsx(T.Option,{value:l.id,children:l.name},l.id))})}),placeholder:"0",style:{width:"100%"},size:"small",onChange:()=>s&&s(d)})}),e.jsx("button",{shape:"circle",className:"flex justify-center items-center hover:bg-black/40 rounded-md",onClick:()=>{i(j),s&&s(d)},children:e.jsx(ie,{size:25})})]})},N))}),e.jsx("div",{className:"flex items-center justify-center mt-2",children:e.jsx(se,{type:"dashed",size:"small",onClick:()=>f(),className:"flex items-center justify-center",block:!0,icon:e.jsx(he,{}),children:"Add Payment"})})]})})}const Et=()=>{const{Option:s}=T,[o,m]=g.useState(!1),[u,a]=g.useState([]),[f,i]=g.useState(0),[N,j]=g.useState(),[c,d]=g.useState(),l=je(),t=V(),[n]=S.useForm(),h=k(b=>b.customers.list),{list:w,loading:I}=k(b=>b.products),{list:x,loading:p}=k(b=>b.termsAndConditions),v=Ot(),[y,C]=g.useState(v),F=k(b=>b.users.list);g.useEffect(()=>{t(ye({status:"true"})),t(oe({page:1,count:100})),t(Pe({query:"all"})),t(xe()),t(Ce())},[t]);const Q=async b=>{try{const M=b.saleInvoiceProduct.reduce((Y,W)=>{const z=W.productId;return Y[z]?Y[z].productQuantity+=W.productQuantity:Y[z]={...W},Y},{}),ee=Object.values(M).map(Y=>{const W=(Y==null?void 0:Y.productQuantity)||0,z=(Y==null?void 0:Y.productSalePrice)||0,P={productId:Y.productId,productQuantity:Y.productQuantity,productUnitSalePrice:Y.productSalePrice,tax:Y.productVat};return P.productDiscount=Y.productDiscount,Y.discountType==="percentage"&&(P.productDiscount=z*W*(Y==null?void 0:Y.productDiscount)/100),P}),J={...b,userId:y,saleInvoiceProduct:ee,paidAmount:b.paidAmount||[]},B=await t(De(J));B.payload.message==="success"?(n.resetFields(),m(!1),l(`/admin/sale/${B.payload.data.id}`)):m(!1)}catch{m(!1)}},R=()=>{const b=n.getFieldValue("saleInvoiceProduct"),M=(b==null?void 0:b.reduce((z,P)=>{const be=(P==null?void 0:P.productQuantity)||0,fe=(P==null?void 0:P.productSalePrice)||0;let ne=(P==null?void 0:P.productDiscount)||0;(P==null?void 0:P.discountType)==="percentage"&&(ne=fe*be*ne/100);const qe=(P==null?void 0:P.productVat)||0,ge=fe*be-ne,Le=qe/100*ge;return[...z,{subDiscount:ne,subVatAmount:Le,subPrice:ge}]},[]))||[];a(M);const K=M.reduce((z,P)=>z+P.subPrice,0),ee=M.reduce((z,P)=>z+P.subVatAmount,0),J=K+ee,B=n.getFieldValue("paidAmount")||[],Y=B==null?void 0:B.reduce((z,P)=>z+(P.amount?parseInt(P.amount):0),0),W=J-Y;i(W)},A=h==null?void 0:h.find(b=>b.id===N),L=u.reduce((b,M)=>b+M.subPrice,0),O=u.reduce((b,M)=>b+M.subVatAmount,0),r=u.reduce((b,M)=>b+M.subDiscount,0),D=L+O;return e.jsx(S,{form:n,name:"dynamic_form_nest_item",onFinish:Q,onFinishFailed:()=>{m(!1)},layout:"vertical",size:"large",onKeyDown:b=>{b.key==="Enter"&&b.preventDefault()},autoComplete:"off",initialValues:{discount:0,date:E(),vatId:[],saleInvoiceProduct:[{}],paymentType:1},children:e.jsxs("div",{className:"flex gap-2 2xl:h-[calc(100vh-100px)] min-h-[500px]",children:[e.jsx("div",{className:"w-[70%] 2xl:w-[75%]",children:e.jsx(zt,{form:n,totalCalculator:R,subTotal:u,productList:w,productLoading:I})}),e.jsxs("div",{className:"flex flex-col w-[30%] 2xl:w-[25%] 2xl:h-[calc(100vh-80px)]",children:[e.jsxs("div",{className:"flex-grow 2xl:overflow-y-auto 2xl:overflow-x-hidden  pl-2",children:[e.jsx(S.Item,{label:e.jsxs(e.Fragment,{children:["Customer",e.jsx(ue,{title:"new Customer",children:e.jsx(Re,{drawer:!0})})]}),className:"w-full mb-0",name:"customerId",rules:[{required:!0,message:"Please Select a Customer!"}],children:e.jsx(T,{className:"w-full",loading:!h,showSearch:!0,onChange:b=>j(b),placeholder:"Select a customer ",optionFilterProp:"children",filterOption:(b,M)=>M.children.toLowerCase().includes(b.toLowerCase()),children:h&&(h==null?void 0:h.map(b=>e.jsx(s,{value:b.id,children:b.username},b.id)))})}),((A==null?void 0:A.address)||(A==null?void 0:A.phone))&&e.jsxs("div",{className:"flex justify-between py-1 px-4",children:[e.jsxs("span",{children:[e.jsx("span",{children:"Address: "}),e.jsx("span",{children:A==null?void 0:A.address})," "]}),e.jsxs("span",{children:[e.jsx("span",{children:"Phone: "}),e.jsx("span",{children:A==null?void 0:A.phone})," "]})]}),e.jsx(S.Item,{label:"Date",required:!0,className:"w-full mb-0",name:"date",rules:[{required:!0,message:"Please input Date!"}],children:e.jsx(_,{label:"date",size:"small",format:"YYYY-MM-DD"})}),e.jsx(S.Item,{label:"Due date",className:"w-full mb-0",name:"dueDate",children:e.jsx(_,{label:"date",size:"small",format:"YYYY-MM-DD"})}),e.jsx(S.Item,{className:"w-full mb-0",label:"Sales Person",name:"userId",required:!0,children:e.jsx(T,{className:"w-full",loading:!F,showSearch:!0,placeholder:"Select sales person ",optionFilterProp:"children",onChange:b=>C(b),filterOption:(b,M)=>M.children.toLowerCase().includes(b.toLowerCase()),children:F&&(F==null?void 0:F.map(b=>e.jsx(s,{value:b.id,children:b.username},b.id)))})}),e.jsx(S.Item,{className:"mb-0",label:"Shipping Address",name:"address",children:e.jsx(X,{className:"",placeholder:"Enter shipping address",size:"small"})}),e.jsx(S.Item,{className:"mb-0",label:"Note",name:"note",children:e.jsx(X,{className:"",size:"small",placeholder:"Write sale Note",label:"note"})}),e.jsx(S.Item,{className:"mb-0",label:e.jsxs(e.Fragment,{children:["Terms and conditions",c&&e.jsx("button",{onClick:()=>d(!1),className:"py-1 px-2 bg-red-200 rounded ml-1 text-gray-500",children:"Cancel"}),e.jsx(ue,{title:"New Terms and conditions",children:e.jsx(jt,{drawer:!0})})]}),name:"termsAndConditions",children:c?e.jsx(X.TextArea,{onChange:b=>d(b),value:c}):e.jsx(T,{className:"w-full",loading:p,showSearch:!0,value:c,placeholder:"Select Terms and conditions",onSelect:b=>d(b),children:x&&(x==null?void 0:x.map(b=>e.jsx(s,{value:b.subject,children:b.title},b.id)))})})]}),e.jsxs("div",{className:"bg-gray-100 px-2",children:[e.jsxs("div",{className:"py-2",children:[e.jsxs("div",{className:" flex justify-between",children:[e.jsx("strong",{children:"Total amount: "}),e.jsxs("strong",{children:[Number(L).toFixed(2)," "]})]}),e.jsxs("div",{className:" flex justify-between",children:[e.jsx("span",{children:"Total discount: "}),e.jsxs("span",{children:[Number(r).toFixed(2)," "]})]}),e.jsxs("div",{className:"py-1 flex justify-between items-center mb-1",children:[e.jsx("span",{children:"Total tax amount: "}),e.jsx("span",{children:Number(O).toFixed(2)})]}),e.jsxs("div",{className:"py-1 flex justify-between items-center mb-1",children:[e.jsx("strong",{children:"Total Payable: "}),e.jsx("strong",{children:Number(D).toFixed(2)})]}),e.jsxs("div",{className:"py-1 mb-1 flex justify-between",children:[e.jsx("strong",{children:"Due Amount:"}),e.jsx("strong",{children:f.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"",children:"Paid Amount: "}),e.jsx("div",{className:"w-[65%] flex items-center justify-between gap-2",children:e.jsx(ze,{totalCalculator:R})})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(S.Item,{className:"w-full pb-0",children:e.jsx(se,{block:!0,type:"primary",htmlType:"submit",loading:o,onClick:()=>m(!0),children:"Create Sale"})})})]})]})]})})},_t=Et;function Se({data:s,info:o,saleInfo:m,pageConfig:u,title:a,type:f,btnName:i}){const{currencySymbol:N}=le()||{},j=k(x=>{var p;return(p=x==null?void 0:x.setting)==null?void 0:p.data})||null;V(),Qe(Math.round((s==null?void 0:s.totalAmount)-(s==null?void 0:s.discount)));const c=We(N),d=[],l=[{label:"Total Unit Quantity",value:`${o!=null&&o.totalUnitQuantity?o.totalUnitQuantity:0}`},{label:"Total  Amount",value:`${c}${o!=null&&o.totalAmount?o.totalAmount:0}`},{label:"Total Due",value:`${c}${o!=null&&o.dueAmount?o.dueAmount:0}`},{label:"Total Paid",value:`${c}${o!=null&&o.paidAmount?o.paidAmount:0}`},{label:"Total Return",value:`${c}${o!=null&&o.totalReturnAmount?o.totalReturnAmount:0}`},{label:"Total Instant Paid Return",value:`${c}${o!=null&&o.instantPaidReturnAmount?o.instantPaidReturnAmount:0}`},{label:"Total Profit",value:`${c}${o!=null&&o.profit?o.profit:0}`}],t=["Date","Invoice","Staff","Product ","QTY","Total","Discount","Vat","Grand Total","Paid","Due","Return"],n=s.map(x=>{var p;return[$(x.date).format("YYYY-MM-DD"),x==null?void 0:x.id,(p=x==null?void 0:x.user)==null?void 0:p.username,x.saleInvoiceProduct.map(v=>{var y,C;return(y=v==null?void 0:v.product)!=null&&y.name?(C=v==null?void 0:v.product)==null?void 0:C.name:""}).join(`,
`),x==null?void 0:x.saleInvoiceProduct.map(v=>v==null?void 0:v.productQuantity).join(`
`),`${c}${x.totalAmount?x.totalAmount:0}`,`${c}${x.totalDiscountAmount?x.totalDiscountAmount:0}`,`${c}${x.totalTaxAmount?x.totalTaxAmount:0}`,`${c}${x.totalAmount?x.totalAmount+x.totalTaxAmount-x.totalDiscountAmount:0}`,`${c}${x.paidAmount?x.paidAmount:0}`,`${c}${x.dueAmount?x.dueAmount:0}`,`${c}${x.returnAmount?x.returnAmount:0}`]}),h=[{value:`Customer: ${m!=null&&m.customer?m==null?void 0:m.customer:"All"}`},{value:`Sale Person: ${m!=null&&m.salePerson?m==null?void 0:m.salePerson:"All"}`}],w=[{value:`From Date: ${$(u==null?void 0:u.startDate).format("YYYY-MM-DD")}`},{value:`To Date: ${$(u==null?void 0:u.endDate).format("YYYY-MM-DD")}`}],I={jsPDF:{orientation:"landscape"},tableFontSize:8,infoTopFontSize:8,bottomRightFontSize:10,bottomLeftFontSize:8,footerFontSize:10};return e.jsx("div",{className:"flex gap-2",children:e.jsx(Z,{className:"bg-primary flex  justify-center items-center px-4 py-2 text-white rounded",onClick:()=>Me(f,{title:a,TopRightInfo:w,companyInfo:j,customerInfo:h,bottomLeftContent:d,bottomRightContent:l,tableBody:n,tableHead:t,settings:I}),children:i})})}function Bt({setPageConfig:s,pageConfig:o,setSaleInfo:m}){const u=V(),{list:a,loading:f}=k(l=>l.customers),{list:i,loading:N}=k(l=>l.users),j=(l,t)=>{const n=l.split(","),h=n[0].trim(),[w,I]=n[1].split(":"),x=w.trim();x==="salePerson"?m(p=>({...p,salePerson:I.trim()})):x==="customer"&&m(p=>({...p,customer:I.trim()})),s(p=>({...p,[t]:h}))},c=l=>{const t=l.format("YYYY-MM-DD");s(n=>({...n,startDate:t}))},d=l=>{const t=l.format("YYYY-MM-DD");s(n=>({...n,endDate:t}))};return g.useEffect(()=>{u(oe({query:"all"})),u(ye({query:"all"}))},[u]),e.jsxs("div",{className:"flex flex-col items-center gap-2 p-5 m-4 rounded bg-white w-2/5",children:[e.jsxs("div",{className:"w-full flex gap-3",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("p",{className:"text-base py-2",children:"Sale Person"}),e.jsx(T,{placeholder:"All",loading:N,showSearch:!1,allowClear:!0,style:{width:"100%"},maxTagPlaceholder:l=>e.jsxs("div",{className:"",children:[l.length," Selected"]}),maxTagCount:0,onChange:l=>j(l,"salePersonId"),children:i==null?void 0:i.map(l=>e.jsx(T.Option,{value:`${l.id},salePerson:${l==null?void 0:l.username}`,children:l==null?void 0:l.username},l.id))})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("p",{className:"text-base py-2",children:"Customer"}),e.jsx(T,{placeholder:"All",loading:f,showSearch:!1,allowClear:!0,style:{width:"100%"},maxTagPlaceholder:l=>e.jsxs("div",{className:"",children:[l.length," Selected"]}),maxTagCount:0,onChange:l=>j(l,"customerId"),children:a==null?void 0:a.map(l=>e.jsx(T.Option,{value:`${l.id},customer:${l==null?void 0:l.username}`,children:l==null?void 0:l.username},l.id))})]})]}),e.jsxs("div",{className:"w-full flex gap-3",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("p",{className:"text-base py-2",children:"From"}),e.jsx(_,{onChange:c,defaultValue:E(o.startDate,"YYYY-MM-DD")})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("p",{className:"text-base py-2",children:"To"}),e.jsx(_,{onChange:d,defaultValue:E(o.endDate,"YYYY-MM-DD")})]})]})]})}function Ut(){const s=V(),[o,m]=g.useState(!1),{list:u,loading:a,info:f}=k(t=>t.sales),[i,N]=g.useState({salePerson:null,customer:null}),[j,c]=g.useState({query:"report",startDate:$().startOf("month").format("YYYY-MM-DD"),endDate:$().endOf("month").format("YYYY-MM-DD")}),d=[{id:1,title:"Invoice No",dataIndex:"id",key:"id",render:(t,{id:n})=>e.jsx(G,{to:`/admin/sale/${n}`,children:n})},{id:2,title:"Date",dataIndex:"date",key:"date",render:t=>$(t).format("ll")},{id:3,title:"Customer Name ",dataIndex:"customer",key:"customerId",render:t=>e.jsx(G,{to:`/admin/customer/${t==null?void 0:t.id}`,children:t==null?void 0:t.username})},{id:4,title:"Total Amount",dataIndex:"totalAmount",key:"totalAmount",render:t=>Number(t).toFixed(2)},{id:5,title:"Discount",dataIndex:"discount",key:"discount",render:t=>Number(t).toFixed(2)},{id:7,title:"Paid Amount",dataIndex:"paidAmount",key:"paidAmount",render:t=>Number(t).toFixed(2),responsive:["md"]},{id:6,title:"Due Amount",dataIndex:"dueAmount",key:"dueAmount",render:t=>Number(t).toFixed(2),responsive:["md"]},{id:8,title:"Profit",dataIndex:"profit",key:"profit",render:t=>Number(t).toFixed(2),responsive:["md"]},{id:9,title:"Sale Person",dataIndex:"user",key:"user",render:t=>e.jsx(G,{to:`/admin/hr/staffs/${t==null?void 0:t.id}`,children:t==null?void 0:t.username}),responsive:["md"]}],l=[{id:2,title:"Date",dataIndex:"date",key:"date",renderCsv:t=>$(t).format("ll")},{id:1,title:"Invoice No",dataIndex:"id",key:"id",renderCsv:t=>t},{id:3,title:"Staff ",dataIndex:"user",key:"staff",renderCsv:t=>t==null?void 0:t.username},{id:5,title:"Product",dataIndex:"saleInvoiceProduct",key:"saleInvoiceProduct",renderCsv:t=>t.length>0?t.map(n=>{var h;return(h=n==null?void 0:n.product)==null?void 0:h.name}):"-"},{id:4,title:"QTY",dataIndex:"saleInvoiceProduct",key:"totalAmount",renderCsv:t=>t.length>0?t.map(n=>n==null?void 0:n.productQuantity):0},{id:4,title:"Total ",dataIndex:"totalAmount",key:"totalAmount",renderCsv:t=>Number(t).toFixed(2)},{id:5,title:"Discount",dataIndex:"totalDiscountAmount",key:"discount",renderCsv:t=>Number(t).toFixed(2)},{id:7,title:"Paid Amount",dataIndex:"paidAmount",key:"paidAmount",renderCsv:t=>Number(t).toFixed(2)},{id:6,title:"Due Amount",dataIndex:"dueAmount",key:"dueAmount",renderCsv:t=>Number(t).toFixed(2)},{id:8,title:"Profit",dataIndex:"profit",key:"profit",renderCsv:t=>Number(t).toFixed(2)}];return g.useEffect(()=>{s(Ke(j))},[s,j]),e.jsx("div",{className:"card card-custom mt-3 ",children:e.jsx("div",{className:"card-body",children:e.jsxs(ae,{className:"max-md:border-0 max-md:bg-white",bodyClass:"max-md:p-0 ",headClass:"border-none",title:"Sale Report",children:[e.jsx(Bt,{setPageConfig:c,pageConfig:j,setSaleInfo:N}),e.jsxs("div",{className:"flex justify-between p-5 items-start ",children:[e.jsx("div",{children:e.jsx(Z,{onClick:()=>m(!0),className:"bg-green-500 text-white",children:"Generate Report"})}),e.jsxs("div",{className:"flex px-5 gap-2 items-center ",children:[!a&&u?e.jsx(Se,{data:u,info:f,saleInfo:i,title:"Sale Report",pageConfig:j,type:"print",btnName:"Print"}):e.jsx("div",{children:e.jsx(Z,{loading:a||!u,className:"bg-primary text-white",children:"Print"})}),!a&&u?e.jsx(Se,{data:u,saleInfo:i,title:"Sale Report",info:f,pageConfig:j,type:"download",btnName:"Export PDF"}):e.jsx("div",{children:e.jsx(Z,{loading:a||!u,className:"bg-primary text-white",children:"Export PDF"})}),e.jsx("div",{children:e.jsx(ct,{list:u,columns:l,title:"Sale Report",className:"bg-primary",btnName:"Export CSV"})})]})]}),o&&e.jsx(yt,{list:u,columns:d,loading:a})]})})})}const Ht=async s=>{try{const{data:o}=await Je({method:"post",headers:{Accept:"application/json","Content-Type":"application/json;charset=UTF-8"},url:"return-sale-invoice/",data:{...s}});return Xe(o)}catch(o){return Ze(o,!0)}},Gt=()=>{const{id:s}=Ae();let o=je();const[m,u]=g.useState({}),[a,f]=g.useState(0),[i,N]=g.useState(!1),j=V(),c=k(y=>y.sales.sale),{singleSaleInvoice:d,returnSaleInvoice:l}=c||{},[t,n]=g.useState([]),[h,w]=g.useState($()),[I]=S.useForm();g.useEffect(()=>{j(ke(s))},[j,s]),g.useEffect(()=>{if(d){const y=d.saleInvoiceProduct.map(C=>{const F=l==null?void 0:l.map(R=>R.returnSaleInvoiceProduct.find(A=>A.productId===C.productId)).reduce((R,A)=>A?{productQuantity:R.productQuantity+A.productQuantity}:R,{productQuantity:0}),Q={...C};return F?(Q.returnQuantity=0,Q.productQuantity=C.productQuantity-F.productQuantity):(Q.returnQuantity=0,Q.remainQuantity=C.productQuantity),Q});n(y)}},[d]);const x=async({note:y,paidAmount:C})=>{try{N(!0);const F={saleInvoiceId:s,note:y,instantReturnAmount:C||[],date:$(h._d).format(),returnSaleInvoiceProduct:Object.entries(m).map(([R,{value:A}])=>({saleInvoiceProductId:parseInt(R),productQuantity:A}))},Q=await Ht(F);(Q==null?void 0:Q.message)==="success"&&o(-1),N(!1)}catch{N(!1)}N(!1)},p=g.useCallback(({id:y,value:C})=>{const F=t.find(Q=>Q.id===y);F&&(m[y]={value:C},F.returnQuantity=C,F.remainQuantity=F.productQuantity-C,n([...t]),u({...m}))},[m,t]),v=()=>t.reduce((y,C)=>y+C.returnQuantity*C.productUnitSalePrice,0);return g.useEffect(()=>{f(v())},[t]),e.jsx("div",{children:e.jsx("div",{className:"mr-top",children:d?e.jsx(g.Fragment,{children:e.jsxs(Te,{bordered:!1,className:"criclebox h-full m-3",children:[e.jsx("div",{className:" flex justify-between ",children:e.jsx("h5",{className:"text-xl",children:e.jsxs("span",{className:"mr-left",children:["Invoice : ",d.id]})})}),e.jsxs("div",{className:"",children:[e.jsx(bt,{formData:m,updateReturn:!0,returnOnChange:p,list:t}),e.jsxs("div",{className:"flex justify-between card-body my-4",children:[e.jsx("div",{className:"mb-auto",children:e.jsxs("p",{className:"mr-left hidden",style:{backgroundColor:"#FDCCCC",padding:"10px",paddingRight:"20px",borderRadius:"2px"},children:["Total Return Amount :",e.jsxs("strong",{children:["  ",a||0]})]})}),e.jsx("div",{className:"max-w-[400px] min-w-[400px]",children:e.jsxs(S,{labelAlign:"right",initialValues:{date:E()},form:I,onFinish:x,autoComplete:"off",children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"",children:"Date: "}),e.jsx("div",{className:"w-[65%]",children:e.jsx(S.Item,{name:"date",className:"mb-0",children:e.jsx(_,{onChange:y=>w(y._d),style:{width:"100%"}})})})]}),e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"",children:"Note: "}),e.jsx("div",{className:"w-[65%]",children:e.jsx(S.Item,{name:"note",className:"mb-0",children:e.jsx(X.TextArea,{placeholder:"Note"})})})]}),e.jsxs("div",{className:"flex justify-between  mb-2 mt-3",children:[e.jsx("span",{className:"",children:"Total Return Amount: "}),e.jsx("div",{className:" font-semibold gap-2",children:a})]}),e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"",children:"Paid Amount: "}),e.jsx("div",{className:"w-[65%] flex items-center justify-between gap-2",children:e.jsx(ze,{})})]}),e.jsx(S.Item,{style:{marginTop:"20px"},className:"mb-2",children:e.jsx(Z,{type:"submit",className:"bg-red-500 text-white hover:bg-red-600",block:!0,loading:i,children:"Make Return"})})]})})]})]})]})},d.id):e.jsx(nt,{})})})},Wt=Gt,Kt=({information:s,count:o,isCustomer:m,title:u})=>{const a=le();return e.jsx(g.Fragment,{children:e.jsxs("section",{className:"grid sm:grid-cols-2 xl:grid-cols-4 gap-6 mt-5 mb-5",children:[e.jsxs("div",{className:"ant-shadow w-full relative sm:p-2 dark:bg-[#2e2d35] flex sm:justify-center items-center md:p-6 p-2 bg-white rounded-lg dashboard-card-bg",children:[e.jsx("div",{className:"sm:hidden inline-flex flex-shrink-0 items-center justify-center h-14 w-14 text-violet-600 bg-violet-100 rounded-lg mr-6",children:e.jsx(xt,{size:30})}),e.jsx("div",{children:e.jsxs(re,{title:e.jsxs("span",{className:"text-lg",children:[e.jsx("span",{dangerouslySetInnerHTML:{__html:a==null?void 0:a.currencySymbol}}),s==null?void 0:s.totalAmount.toFixed(3)]}),children:[e.jsxs("span",{className:"block text-violet-600 text-2xl sm:text-3xl font-bold sm:text-center",children:[" ",e.jsx("span",{dangerouslySetInnerHTML:{__html:a==null?void 0:a.currencySymbol}}),s!=null&&s.totalAmount?te(Number(s.totalAmount)):0]}),e.jsxs("span",{className:"uppercase sm:text-[14px] block font-semibold sm:font-bold sm:mt-2  dark:text-yellow-100 ",children:["Total Sales"," ",e.jsxs("span",{className:"text-violet-600",children:["#",o?te(o):0]})]})]})})]}),e.jsxs("div",{className:"ant-shadow w-full relative sm:p-2 dark:bg-[#2e2d35] flex sm:justify-center items-center md:p-6 p-2 bg-white rounded-lg dashboard-card-bg",children:[e.jsx("div",{className:"sm:hidden inline-flex flex-shrink-0 items-center justify-center h-14 w-14 text-violet-500 bg-violet-100 rounded-lg mr-6",children:e.jsx(St,{size:30})}),e.jsx("div",{children:e.jsxs(re,{title:e.jsxs("span",{className:"text-lg",children:[e.jsx("span",{dangerouslySetInnerHTML:{__html:a==null?void 0:a.currencySymbol}}),s==null?void 0:s.paidAmount.toFixed(3)]}),children:[e.jsxs("span",{className:"block text-violet-500 text-2xl sm:text-3xl font-bold sm:text-center",children:[e.jsx("span",{dangerouslySetInnerHTML:{__html:a==null?void 0:a.currencySymbol}}),s!=null&&s.paidAmount?te(Number(s.paidAmount)):0]}),e.jsxs("span",{className:"uppercase sm:text-[14px] block font-semibold sm:font-bold sm:mt-2  dark:text-yellow-100 ",children:["Total Sale Paid"," "]})]})})]}),e.jsxs("div",{className:"ant-shadow w-full relative sm:p-2 dark:bg-[#2e2d35] flex sm:justify-center items-center md:p-6 p-2 bg-white rounded-lg dashboard-card-bg",children:[e.jsx("div",{className:"sm:hidden inline-flex flex-shrink-0 items-center justify-center h-14 w-14 text-blue-600 bg-blue-100 rounded-lg mr-6",children:e.jsx(It,{size:30})}),e.jsx("div",{children:e.jsxs(re,{title:e.jsxs("span",{className:"text-lg",children:[e.jsx("span",{dangerouslySetInnerHTML:{__html:a==null?void 0:a.currencySymbol}}),s==null?void 0:s.dueAmount.toFixed(3)]}),children:[e.jsxs("span",{className:"block text-blue-600 text-2xl sm:text-3xl font-bold sm:text-center",children:[e.jsx("span",{dangerouslySetInnerHTML:{__html:a==null?void 0:a.currencySymbol}}),s!=null&&s.dueAmount?te(s==null?void 0:s.dueAmount):0]}),e.jsxs("span",{className:"uppercase sm:text-[14px] block font-semibold sm:font-bold sm:mt-2 dark:text-yellow-100 ",children:[" ","Total Sale Due"," "]})]})})]}),e.jsxs("div",{className:"ant-shadow w-full relative sm:p-2 dark:bg-[#2e2d35] flex sm:justify-center items-center md:p-6 p-2 bg-white rounded-lg dashboard-card-bg",children:[e.jsx("div",{className:"sm:hidden inline-flex flex-shrink-0 items-center justify-center h-14 w-14 text-blue-600 bg-blue-100 rounded-lg mr-6",children:e.jsx(At,{size:30})}),e.jsx("div",{children:e.jsxs(re,{title:e.jsxs("span",{className:"text-lg",children:[e.jsx("span",{dangerouslySetInnerHTML:{__html:a==null?void 0:a.currencySymbol}}),s==null?void 0:s.profit.toFixed(3)]}),children:[e.jsxs("span",{className:"block text-blue-600 text-2xl sm:text-3xl font-bold sm:text-center",children:[e.jsx("span",{dangerouslySetInnerHTML:{__html:a==null?void 0:a.currencySymbol}}),s!=null&&s.profit?te(s==null?void 0:s.profit):0]}),e.jsxs("span",{className:"uppercase sm:text-[14px] block font-semibold sm:font-bold sm:mt-2 dark:text-yellow-100 ",children:[" ","Total Sale Profit"]})]})})]})]})})},Jt=()=>{var R,A,L,O;const s=V(),[o,m]=g.useState(!1),{list:u,total:a,loading:f}=k(r=>r.sales),[i,N]=g.useState({}),{list:j}=k(r=>r.customers),{list:c}=k(r=>r.users),[d,l]=g.useState(),t=k(r=>{var D;return(D=r==null?void 0:r.setting)==null?void 0:D.data})||null,[n,h]=g.useState({page:1,count:10,status:"true",startDate:$().startOf("month").format("YYYY-MM-DD"),endDate:$().endOf("month").format("YYYY-MM-DD"),user:""}),w=(R=i==null?void 0:i.customer)==null?void 0:R.email,I=`Your order has been placed. Order ID #${i==null?void 0:i.id}`,x=`
   <div>Dear <strong>${(A=i==null?void 0:i.customer)==null?void 0:A.username}</strong>,</div>
   <div>Greetings! We trust this message reaches you in great spirits. We are immensely grateful for the privilege of having you as our esteemed customer.</div>
   <br>
   <strong>Order Information:</strong><br>
   <p>Order ID: ${i==null?void 0:i.id}</p>
   <p>Order Date: ${$(i==null?void 0:i.date).format("ll")}</p>
   <br>
   <strong>Invoice Details:</strong><br>
   <p>Total Amount: $${i!=null&&i.totalAmount?Number(i.totalAmount+((i==null?void 0:i.totalDiscountAmount)||0)).toFixed(2):0} </p>
   <p>Discount: $${i!=null&&i.totalDiscountAmount?Number(i.totalDiscountAmount).toFixed(2):0} </p>
   <p>
   Tax: $${i!=null&&i.totalTaxAmount?Number(i.totalTaxAmount).toFixed(2):0} </p>
   <p>Paid Amount: $${i!=null&&i.totalPaidAmount?Number(i==null?void 0:i.totalPaidAmount).toFixed(2):0}</p>
   <p>Due Amount: $${i!=null&&i.dueAmount?Number(i==null?void 0:i.dueAmount).toFixed(2):0}</p>
   <br>
   <p>Best Regards,</p>
   <p>${t==null?void 0:t.companyName}</p>
   <p>${t==null?void 0:t.phone}</p>
   <p>${t==null?void 0:t.email}</p>`,p=[{id:1,title:"Invoice",dataIndex:"id",key:"id",render:(r,{id:D})=>e.jsx(G,{to:`/admin/sale/${D}`,children:D}),renderCsv:r=>r},{id:2,title:"Date",dataIndex:"date",key:"date",render:r=>$(r).format("ll"),renderCsv:r=>$(r).format("ll")},{id:3,title:"Customer",dataIndex:"customer",key:"customerId",render:r=>e.jsx(G,{to:`/admin/customer/${r==null?void 0:r.id}`,children:r==null?void 0:r.username}),renderCsv:r=>r==null?void 0:r.username},{id:4,title:"Total Amount",dataIndex:"totalAmount",key:"totalAmount",render:r=>Number(r).toFixed(2),renderCsv:r=>Number(r).toFixed(2)},{id:7,title:"Paid",dataIndex:"paidAmount",key:"paidAmount",render:r=>Number(r).toFixed(2),responsive:["md"],renderCsv:r=>Number(r).toFixed(2)},{id:6,title:"Due",dataIndex:"dueAmount",key:"dueAmount",render:r=>Number(r).toFixed(2),renderCsv:r=>Number(r).toFixed(2),responsive:["md"]},{id:6,title:"Tax",dataIndex:"totalTaxAmount",key:"totalTaxAmount",render:r=>Number(r).toFixed(2),renderCsv:r=>Number(r).toFixed(2),responsive:["md"]},{id:5,title:"Due date",dataIndex:"dueDate",key:"discount",render:r=>r?e.jsxs("div",{className:"flex gap-1 items-center",children:[$(r).format("ll"),Nt(r)&&e.jsx(ut,{className:"text-xs",color:"red",children:"Overdue"})]}):null,renderCsv:r=>Number(r).toFixed(2)},{id:8,title:"Profit",dataIndex:"profit",key:"profit",render:r=>Number(r).toFixed(2),renderCsv:r=>Number(r).toFixed(2),responsive:["md"]},{id:9,title:"Sale Person",dataIndex:"user",key:"user",render:r=>e.jsx(G,{to:`/admin/hr/staffs/${r==null?void 0:r.id}`,children:r==null?void 0:r.username}),renderCsv:r=>r==null?void 0:r.username,responsive:["md"]},{id:10,title:"",dataIndex:"id",key:"action",render:r=>[{label:e.jsx($e,{title:"View",path:`/admin/sale/${r==null?void 0:r.id}`}),key:"view"},{label:e.jsx(e.Fragment,{children:e.jsx("span",{onClick:()=>{l(r)},children:e.jsxs("button",{className:"flex items-center gap-2 rounded disabled:cursor-not-allowed disabled:opacity-50 py-1",disabled:(r==null?void 0:r.dueAmount)===0,children:[e.jsx(rt,{className:"text-[1rem]"}),"Make a payment"]})})}),key:"edit"},{label:e.jsxs("div",{onClick:()=>{F(),s(ke(r==null?void 0:r.id)),N(r)},className:"flex gap-2  items-center cursor-pointer",children:[e.jsx(pt,{className:"text-[1rem]"}),"Email"]}),key:"SendEmail"}],csvOff:!0}],v=[{key:"salePersonId",label:"Sale Person",type:"select",options:c==null?void 0:c.map(r=>({label:r==null?void 0:r.username,value:r.id})),className:"min-w-[120px] max-w-[150px]",popupClassName:"w-[200px]"},{key:"customerId",label:"Customer",type:"select",options:j==null?void 0:j.map(r=>({label:r==null?void 0:r.username,value:r==null?void 0:r.id})),className:"min-w-[100px] max-w-[150px]",popupClassName:"w-[200px]"},{key:"orderStatus",label:"Status",type:"select",options:[{label:"Pending",value:"pending"},{label:"Received",value:"received"}],className:"min-w-[85px] max-w-[150px]",popupClassName:"w-[200px]"}];g.useEffect(()=>{s(oe({query:"all"})),s(ye({query:"all"})),!t&&s(Ie())},[t,s]);const{RangePicker:y}=_;g.useEffect(()=>{s(et(n))},[s,n]);const C=r=>{const D=r[0].format("YYYY-MM-DD"),b=r[1].format("YYYY-MM-DD");h(M=>({...M,startDate:D,endDate:b}))},F=()=>{m(!0)},Q=()=>{m(!1)};return e.jsxs("div",{className:"card card-custom mt-2",children:[e.jsxs("div",{className:"card-body",children:[e.jsx(Kt,{information:a==null?void 0:a._sum,count:(L=a==null?void 0:a._count)==null?void 0:L.id,isCustomer:!0}),e.jsx("br",{}),e.jsx(ae,{className:"max-md:border-0 max-md:bg-white",bodyClass:"max-md:p-0 ",headClass:"border-none",title:"Sale Invoice",extra:e.jsxs(e.Fragment,{children:[" ",e.jsx("div",{children:e.jsx(y,{className:"range-picker",onCalendarChange:C,defaultValue:[E(n.startDate,"YYYY-MM-DD"),E(n.endDate,"YYYY-MM-DD")]})}),e.jsx(wt,{to:"/admin/sale/add",title:"Create Sale"})]}),children:e.jsx(Fe,{permission:"readAll-saleInvoice",children:e.jsx(Ye,{list:u,columns:p,loading:f,total:(O=a==null?void 0:a._count)==null?void 0:O.id,setPageConfig:h,title:"Sale List",filters:v,isSearch:!0})})})]}),e.jsx(ve,{title:"Send Sale Invoice",open:o,className:"bg-white",onClose:Q,footer:!1,children:e.jsx(ft,{setIsModalOpen:m,modal:!0,onClose:()=>m(!1),body:x,subject:I,customerEmail:w})}),e.jsx(ve,{outsideClick:!0,open:d,title:"Make Sale",className:"bg-white",onClose:()=>l(!1),children:e.jsx(gt,{data:d,onClose:()=>l(!1)})})]})},Xt=Jt;function Bs(){return e.jsxs(tt,{children:[e.jsx(U,{path:"/sale",exact:!0,element:e.jsx(H,{permission:"readAll-saleInvoice",children:e.jsx(Xt,{})})}),e.jsx(U,{path:"/sale/add",exact:!0,element:e.jsx(H,{permission:"create-saleInvoice",children:e.jsx(_t,{})})}),e.jsx(U,{path:"/sale/:id",element:e.jsx(H,{permission:"readSingle-saleInvoice",children:e.jsx(vt,{})})}),e.jsx(U,{path:"/sale-report",element:e.jsx(H,{permission:"readAll-saleInvoice",children:e.jsx(Ut,{})})}),e.jsx(U,{path:"/sale/return/:id",element:e.jsx(H,{permission:"create-returnSaleInvoice",children:e.jsx(Wt,{})})}),e.jsx(U,{path:"/sale-return-list",element:e.jsx(H,{permission:"readAll-returnSaleInvoice",children:e.jsx(Dt,{})})}),e.jsx(U,{path:"/sale-return-list/:id",element:e.jsx(H,{permission:"readSingle-returnSaleInvoice",children:e.jsx(Tt,{})})}),e.jsx(U,{path:"/pos",exact:!0,element:e.jsx(H,{permission:"readAll-saleInvoice",children:e.jsx(Vt,{})})})]})}export{Bs as default};
