import{u as f,b as v,r as p,be as b,j as e,F as i,B as g,P as N,e as F,c8 as P}from"./index-16ff5701.js";import{e as w}from"./AdminLayout-ac80ae52.js";import{S as j}from"./Button-81cb4f36.js";import{I as C}from"./index-6d01e873.js";function I({form:l}){const n=f(),{list:r,loading:m}=v(s=>s.products),x=s=>{const d=l.getFieldValue("products").map((c,a)=>a===s?{...c,productQuantity:0}:c);l.setFieldsValue({products:d})};return p.useEffect(()=>{n(b({query:"all"}))},[n]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-12 gap-2",children:[e.jsx("div",{className:"col-span-1 font-weight-bold md:text-base xxs:text-xs",children:"SL"}),e.jsx("div",{className:"col-span-8 font-weight-bold md:text-base xxs:text-xs",children:"Product"}),e.jsx("div",{className:"col-span-2 font-weight-bold md:text-base xxs:text-xs",children:"Quantity"}),e.jsx("div",{className:"col-span-1 md:text-base xxs:text-xs"})]}),e.jsx("hr",{style:{backgroundColor:"black",marginTop:"0.5rem"}}),e.jsx(i.List,{name:"products",rules:[{required:!0,message:"Product is required"}],children:(s,{add:u,remove:d})=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"max-h-[200px] grid w-full overflow-y-auto overflow-x-visible mt-2",children:s.map(({key:c,name:a,...t},h)=>e.jsxs("div",{className:"grid grid-cols-12 gap-2",children:[e.jsx("div",{className:"col-span-1",children:h+1}),e.jsx("div",{className:"col-span-8",children:e.jsx(i.Item,{...t,name:[a,"id"],rules:[{required:!0,message:"Product is required"}],children:e.jsx(j,{placeholder:"Select Product",showSearch:!0,loading:m,optionFilterProp:"children",filterOption:(o,y)=>y.children.toLowerCase().includes(o.toLowerCase()),onChange:()=>{x(h)},children:r==null?void 0:r.map(o=>e.jsx(j.Option,{value:o.id,children:o.name},o.id))})})}),e.jsx("div",{className:"col-span-2",children:e.jsx(i.Item,{...t,name:[a,"productQuantity"],rules:[{required:!0,message:"quantity is required"}],children:e.jsx(C,{size:"small",placeholder:"Quantity"})})}),e.jsx("div",{className:"col-span-1",children:e.jsx(i.Item,{children:e.jsx("button",{shape:"circle",className:"flex justify-center items-center hover:bg-black/40 rounded-md",onClick:()=>{d(a)},children:e.jsx(w,{size:25})})})})]},c))}),e.jsx(i.Item,{style:{marginTop:"20px"},children:e.jsx(g,{type:"dashed",onClick:()=>u(),block:!0,icon:e.jsx(N,{}),children:"Add Product"})})]})})]})}function O({list:l}){const[n,r]=p.useState(!1),m=F(),x=f(),[s]=i.useForm(),u=async d=>{var a;const c=d.products.map(t=>({productId:t.id,productQuantity:t.productQuantity}));try{const t=await x(P(c));t.payload.message==="success"?(s.resetFields(),r(!1),m(`/admin/purchase-reorder-invoice/${(a=t.payload.data[0])==null?void 0:a.reorderInvoiceId}`)):r(!1)}catch{r(!1)}};return p.useEffect(()=>{s.setFieldsValue({products:l})},[s,l]),e.jsx("div",{children:e.jsxs(i,{form:s,className:"w-full ",name:"dynamic_form_nest_item",onFinish:u,onFinishFailed:()=>{r(!1)},layout:"vertical",size:"large",autoComplete:"off",initialValues:{},children:[e.jsx(I,{form:s}),e.jsx(i.Item,{style:{marginTop:"15px"},children:e.jsx(g,{block:!0,type:"primary",htmlType:"submit",loading:n,onClick:()=>r(!0),children:"Create Purchase Order"})})]})})}export{O as A};
