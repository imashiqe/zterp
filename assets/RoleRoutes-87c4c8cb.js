import{b5 as B,e as q,o as Y,r as x,a5 as H,F as k,j as e,N as G,C as J,B as I,a3 as $,u as T,b as R,cZ as F,c_ as V,c$ as Z,I as _,d0 as K,cY as L,L as D,k as E,d1 as Q,x as W,y as S}from"./index-16ff5701.js";import{L as O,P as A}from"./AdminLayout-ac80ae52.js";import{U as M,C as U,T as X}from"./TableComponent-f70e0475.js";import{C as ee}from"./index-8b1cef28.js";import{T as z}from"./index-1ab3c210.js";import{V as se}from"./ViewBtn-eedc84ae.js";import{C as te}from"./CommonDelete-6a643bdc.js";import{C as re}from"./CreateDrawer-33537b52.js";import"./Button-81cb4f36.js";import"./useForceUpdate-5b1eefe7.js";import"./EditOutlined-f754bc7b.js";import"./DeleteOutlined-e1f8fe69.js";const ae=async a=>{try{const{data:n}=await B({method:"post",headers:{Accept:"application/json","Content-Type":"application/json;charset=UTF-8"},url:"role-permission",data:{...a}});return{data:n,message:"success"}}catch{return{message:"error"}}},ne=async()=>{const{data:a}=await B.get("permission?query=all");return a};function ie(a){const n=a.permissionNames,{selectedPermission:m,setSelectedPermission:p}=a,i=n.map(r=>e.jsx(x.Fragment,{children:e.jsx(ee,{value:r.id,onChange:()=>{p(h=>({...h,[r.id]:!h[r.id]}))},checked:m[r.id],children:r.name})},r.id)),d=[];for(let r=0;r<i.length;r+=5)d.push(e.jsxs("div",{className:"flex flex-col sm:flex-row  justify-between m-4 border-2 border-indigo-100 px-4 py-3  overflow-x-auto ",children:[i.slice(r,r+5),e.jsx("br",{})]},r));return e.jsx("div",{children:d})}const oe=()=>{const a=q(),{id:n}=Y(),[m,p]=x.useState([]),[i,d]=x.useState({}),r=H(),{data:h}=r.state,t=h.name,f=h.rolePermission,{Title:u}=z,[b]=k.useForm(),[w,j]=x.useState(!1);x.useEffect(()=>{ne().then(s=>{p(s);const o=s.reduce((l,c)=>(l[c.id]=f.some(g=>g.permissionId===c.id),l),{});d(o)})},[n]);const v=Object.entries(i).reduce((s,[o,l])=>(l&&s.push(o),s),[]),P=async s=>{j(!0);try{const o={roleId:parseInt(n),permissionId:v.map(Number)},l=await ae(o);l.message==="success"&&(a(-1),j(!1)),l.message==="error"&&($.error("Error at giving permission, Try again"),j(!1),b.resetFields()),b.resetFields()}catch{j(!1)}};return!localStorage.getItem("isLogged")?e.jsx(G,{to:"/admin/auth/login",replace:!0}):e.jsx(e.Fragment,{children:e.jsx(M,{permission:"create-rolePermission",children:e.jsxs(J,{bordered:!1,className:" h-full",children:[e.jsxs(u,{level:3,className:"m-3 text-center mb-5",children:["Add Permission : ",e.jsx("span",{className:"text-primary",children:t})]}),m.length>0?e.jsxs(e.Fragment,{children:[e.jsx(ie,{permissionNames:m,hasPermissions:f,setSelectedPermission:d,selectedPermission:i}),e.jsx("div",{className:"text-center",children:e.jsx(I,{className:"",onClick:P,type:"primary",htmlType:"submit",size:"large",shape:"round",loading:w,children:"Permit Now"})})]}):e.jsx(O,{})]})})})},le=oe,ce=()=>{const{id:a}=Y(),n=T(),[m,p]=x.useState([]),[i,d]=x.useState(!0),[r,h]=x.useState(!1),{list:t}=R(s=>s.permission),f=x.useMemo(()=>me(t),[t]),{role:u,loading:b}=R(s=>s.role),w=(s,o)=>{const l=f[s].map(c=>c.id);p(c=>{const g=[...c];return l.forEach(y=>{const N=g.indexOf(y);N!==-1&&g.splice(N,1)}),o?g.concat(l):g})},j=(s,o)=>{p(l=>{const c=[...l],g=t==null?void 0:t.filter(y=>y.name.includes(s)).map(y=>y.id);return g.forEach(y=>{const N=c.indexOf(y);N!==-1&&c.splice(N,1)}),o?c.concat(g):c})},v=async s=>{p(o=>{const l=[...o],c=l.indexOf(s);return c!==-1?l.splice(c,1):l.push(s),l})},P=async()=>{h(!0),(await n(Z({roleId:parseInt(a),permissionId:m}))).payload.message==="success"&&n(F(a)),h(!1)};x.useEffect(()=>{u&&p(u==null?void 0:u.rolePermission.map(s=>s.permissionId))},[u]),x.useEffect(()=>{n(F(a)),n(V())},[n,a]),x.useEffect(()=>{if(u){const s=u.rolePermission.map(l=>l.permissionId)||[];s.sort();const o=[...m];o.sort(),JSON.stringify(s)!==JSON.stringify(o)?d(!1):d(!0)}},[u,m]);let C=null;return b?C=e.jsx(O,{}):!b&&u&&(C=e.jsx(U,{className:"max-md:border-0 max-md:bg-white",bodyClass:"max-md:p-0 ",headClass:"border-none",title:"Permissions of "+(u==null?void 0:u.name),extra:e.jsx(e.Fragment,{children:e.jsx(I,{disabled:i,loading:r,type:"primary",className:"",onClick:P,children:"Permit now"})}),children:e.jsx("div",{className:"tableScrollBar overflow-y-auto w-full",children:e.jsx("div",{className:"max-h-[calc(100vh-165px)]",children:e.jsxs("table",{className:"border-collapse w-full ",children:[e.jsx("thead",{className:"font-Popins text-black/70 bg-tableHeaderBg  border-gray-200 sticky top-[-1px] z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border",children:"Permission Name"}),e.jsx("th",{className:"border",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("input",{onChange:s=>j("create-",s.target.checked),type:"checkbox",className:"mr-2"}),e.jsx("span",{children:"Create"})]})}),e.jsx("th",{className:"border py-2",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("input",{onChange:s=>j("delete-",s.target.checked),type:"checkbox",className:"mr-2"}),e.jsx("span",{children:"Delete"})]})}),e.jsx("th",{className:"border py-2",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("input",{onChange:s=>j("readAll-",s.target.checked),type:"checkbox",className:"mr-2"}),e.jsx("span",{children:"Read All"})]})}),e.jsx("th",{className:"border py-2",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("input",{onChange:s=>j("readSingle-",s.target.checked),type:"checkbox",className:"mr-2"}),e.jsx("span",{children:"Read Single"})]})}),e.jsx("th",{className:"border py-2",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("input",{onChange:s=>j("update-",s.target.checked),type:"checkbox",className:"mr-2"}),e.jsx("span",{children:"Update"})]})})]})}),e.jsx("tbody",{children:Object.keys(f).map(s=>e.jsxs("tr",{className:"",children:[e.jsxs("td",{className:"border pl-4",children:[e.jsx("input",{title:"Select Row",type:"checkbox",onChange:o=>w(s,o.target.checked),className:"mr-4"}),s]}),f[s].map(o=>{const l=m.find(c=>c===o.id);return e.jsx("td",{className:"border align-middle text-center",children:e.jsx("input",{disabled:b,onChange:c=>v(o.id),checked:!!l,type:"checkbox"})},o.id)})]},s))})]})})})})),C},de=ce;function me(a){if(!Array.isArray(a))return{};function n(i){return(i.match(/[A-Z]?[a-z]+/g)||[]).map(h=>h.charAt(0).toUpperCase()+h.slice(1)).join(" ")}const m=a.filter(i=>i.name.includes("create")).map(i=>i.name.replace("create-","")),p={};return m.forEach(i=>{const d=a.filter(r=>r.name.split("-")[1]===i);d.sort((r,h)=>{const t=r.name.toLowerCase(),f=h.name.toLowerCase();return t<f?-1:t>f?1:0}),p[n(i)]=d}),p}const pe=()=>{const[a,n]=x.useState(!1),m=T(),{Title:p}=z,i=async r=>{n(!0),await m(K(r)),n(!1)},d=()=>{$.error("Failed at adding role"),n(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(p,{level:4,className:"m-2 mt-5 text-center",children:"Create New Role"}),e.jsx(k,{eventKey:"role-form",name:"basic",layout:"vertical",className:"sm:mx-10",onFinish:i,onFinishFailed:d,autoComplete:"off",children:e.jsxs("div",{children:[e.jsx(k.Item,{style:{marginBottom:"20px"},label:"Name",name:"name",rules:[{required:!0,message:"Please input your username!"}],children:e.jsx(_,{})}),e.jsx(k.Item,{style:{marginBottom:"10px"},children:e.jsx(I,{onClick:()=>n(!0),type:"primary",size:"small",htmlType:"submit",block:!0,loading:a,children:"Create New Role"})})]})})]})},he=()=>{const a=T(),{list:n,total:m,loading:p}=R(t=>t.role),[i,d]=x.useState({page:1,count:10,status:"true"}),r=[{id:1,title:"ID",dataIndex:"id",key:"id",render:t=>e.jsx(D,{to:`/admin/role/${t}/`,children:t}),renderCsv:t=>t},{id:2,title:"Name",dataIndex:"name",key:"name",render:(t,{id:f})=>e.jsx(D,{to:`/admin/role/${f}/`,children:t}),renderCsv:t=>t},{id:3,title:"Created at",dataIndex:"createdAt",key:"createdAt",render:t=>E(t).format("YYYY-MM-DD"),renderCsv:t=>E(t).format("YYYY-MM-DD")},{id:4,title:"",key:"action",render:({id:t})=>[{label:e.jsx(se,{title:"view",path:`/admin/role/${t}`}),key:"view"},{label:e.jsx(te,{permission:"delete-role",deleteThunk:Q,id:t,title:"Hide",loadThunk:L,query:i}),key:"delete"}],csvOff:!0}],h=[{key:"status",label:"Status",type:"select",options:[{label:"Show",value:"true"},{label:"Hide",value:"false"}],className:"min-w-[85px] max-w-[150px]",popupClassName:"w-[200px]"}];return x.useEffect(()=>{a(L(i))},[a,i]),e.jsx(U,{title:"Roles",extra:e.jsx(re,{permission:"create-role",title:"Create Role",width:35,children:e.jsx(pe,{})}),children:e.jsx(M,{permission:"readAll-role",children:e.jsx(X,{columns:r,list:n,total:m,setPageConfig:d,loading:p,title:"Role List",filters:h,isSearch:!0})})})},xe=he;function Se(){return e.jsxs(W,{children:[e.jsx(S,{path:"/role",exact:!0,element:e.jsx(A,{permission:"readAll-role",children:e.jsx(xe,{})})}),e.jsx(S,{path:"/role/:id",element:e.jsx(A,{permission:"readSingle-role",children:e.jsx(de,{})})}),e.jsx(S,{path:"/role/permit/:id/",element:e.jsx(A,{permission:"update-permission",children:e.jsx(le,{})})})]})}export{Se as default};
