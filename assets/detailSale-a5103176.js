import{j as e,k as P,L as M,bh as se,b as T,u as S,q as Z,r as f,s as U,F as v,a3 as K,cn as V,b5 as oe,I as Q,B as q,c4 as ne,c1 as le,P as re,cp as ae,co as ie,o as ce,cq as de}from"./index-16ff5701.js";import{a as O,g as ue,S as B,s as me,t as xe,M as pe,b as he}from"./Button-81cb4f36.js";import{d as H,l as be,C as R,f as z}from"./TableComponent-f70e0475.js";import{L}from"./List-ddf690f6.js";import{f as fe,e as je,T as ye,c as Y,L as Ne,D as ge}from"./AdminLayout-ac80ae52.js";import{V as ve}from"./ViewBtn-eedc84ae.js";import{I as ee}from"./index-6d01e873.js";import{i as W}from"./invoiceGenerator-91e8874d.js";import{n as _}from"./numberToWords-4c291141.js";import{u as G}from"./useCurrency-ff395f2c.js";import{A as Ae}from"./AddTransaction-47663915.js";import{M as Ce}from"./index-2e4f1652.js";import{D as Pe}from"./index-0daf2765.js";import{R as Ie}from"./index-4f6b3efe.js";import{C as Te,T as X}from"./TagInput-4d878cae.js";import{t as Se,a as $e}from"./AddProduct-4dee3988.js";import{C as J}from"./Collapse-d1408748.js";import{M as Fe}from"./ModalUi-03657474.js";import{d as De}from"./dayjs.min-72f12467.js";import{D as ke}from"./index-f03f7796.js";import{T as we}from"./index-1ab3c210.js";import{P as Re}from"./index-8b1cef28.js";const Le=({list:t})=>{const r=[{id:2,title:"ID",dataIndex:"id",key:"id"},{id:4,title:"Total Amount",key:"totalAmount",render:({totalAmount:l,tax:a})=>`${l+(a||0)}`},{id:5,title:"Note",dataIndex:"note",key:"note"},{id:3,title:"Date",dataIndex:"date",key:"date",render:l=>P(l).format("ll")},{id:1,title:"Action",key:"returnSaleInvoiceProduct",render:({id:l})=>e.jsx(ve,{path:`/admin/sale-return-list/${l}`})}],o=l=>l.map(a=>({...a,key:a.id}));return e.jsx("div",{className:"m-1 md:mt-4",children:e.jsx(H,{scroll:{x:!0},loading:!t,columns:r,data:t?o(t):[]})})},Oe=({list:t,updateReturn:r,returnOnChange:o})=>{const l=[{title:"ID",dataIndex:"productId",key:"productId"},{title:"Name",dataIndex:"product",render:n=>e.jsx(M,{to:`/admin/product/${n.id}`,children:n.name}),tdClass:"whitespace-normal"},{title:r?"Returnable Quantity":"Quantity",dataIndex:"productQuantity",key:"productQuantity"},{title:"Price",dataIndex:"productUnitSalePrice",key:"productUnitSalePrice",width:"150px"},{title:"Discount",dataIndex:"productDiscount",key:"productDiscount"},{title:"Amount",key:"Total Price ",dataIndex:"",render:({productFinalAmount:n})=>n},{title:"Tax Amount",dataIndex:"taxAmount",key:"taxAmount"}];r&&l.splice(4,0,{title:"Return Quantity",dataIndex:"returnQuantity",key:"returnQuantity",width:"150px",render:(n,{id:i,productQuantity:m})=>e.jsx("div",{children:e.jsx(ee,{className:"px-0",onChange:h=>o({id:i,value:h}),style:{width:"120px"},placeholder:"Return Qty",max:m,min:0,value:n})})});const a=n=>n.map(i=>({...i,key:i.id}));return e.jsx("div",{className:"m-1 md:mt-4",children:e.jsx(H,{scroll:{x:!0},loading:!t,columns:l,data:t?a(t):[]})})},Me=({list:t})=>{const r=[{id:1,title:"ID",dataIndex:"id",key:"id",render:l=>e.jsx(M,{to:`/admin/transaction/${l}`,children:l})},{id:2,title:"Date",dataIndex:"date",key:"date",render:l=>P(l).format("ll")},{id:3,title:"Debit",dataIndex:"debit",key:"debit",render:l=>l.name},{id:4,title:"Credit",dataIndex:"credit",key:"credit",render:l=>l.name},{id:5,title:"Amount",dataIndex:"amount",key:"amount"},{id:6,title:"Type ",dataIndex:"type",key:"type"},{id:7,title:"Particulars",dataIndex:"particulars",key:"particulars",render:l=>e.jsx("div",{title:l,children:se(l,20)})}],o=l=>l.map(a=>({...a,key:a.id}));return e.jsx("div",{className:"m-1 md:mt-4",children:e.jsx(H,{scroll:{x:!0},loading:!t,columns:r,data:t?o(t):[]})})};function Be({sale:t,title:r}){var b,c,d,s;const{singleSaleInvoice:o}=t||{},{currencyName:l}=G()||{},a=T(x=>{var A;return(A=x==null?void 0:x.setting)==null?void 0:A.data})||null;S();const i=[{label:"IN WORDS: ",value:`${_(Math.round(o.totalAmount)).toUpperCase()} ${l}`||""},{label:"Notes: ",value:o.note?o.note:""},{label:"Terms And Conditions: ",value:o.termsAndConditions?o.termsAndConditions:""}],m=[{label:"Total:",value:`${o!=null&&o.totalAmount?Number(o.totalAmount+((o==null?void 0:o.totalDiscountAmount)||0)).toFixed(2):0}`},{label:"Discount",value:`${o!=null&&o.totalDiscountAmount?Number(o.totalDiscountAmount).toFixed(2):0}`},{label:"Total Tax:",value:`${o!=null&&o.totalTaxAmount?Number(o.totalTaxAmount).toFixed(2):0}`},{label:"Return product value:",value:`${t.totalReturnAmount?Number(t.totalReturnAmount).toFixed(2):0}`},{label:"Return Amount:",value:`${t.instantPaidReturnAmount?Number(t.instantPaidReturnAmount).toFixed(2):0}`},{label:"Paid:",value:`${t.totalPaidAmount?Number(t.totalPaidAmount).toFixed(2):0}`},{label:"Due:",value:`${o.dueAmount}`}],h=["SL","Name","Quantity","Price","Discount","Amount","Tax"],p=o.saleInvoiceProduct.map((x,A)=>[A,x.product.name,x.productQuantity,`${x.productDiscount||0}`,`${x.productFinalAmount}`,`${x.productUnitSalePrice}`,`${x.taxAmount}`]),y=[{value:`Client Id: ${o==null?void 0:o.customerId}`},{value:`Client Name: ${(b=o==null?void 0:o.customer)==null?void 0:b.username}`},{value:`Address: ${(c=o==null?void 0:o.customer)!=null&&c.address?(d=o==null?void 0:o.customer)==null?void 0:d.address:""}`},{value:`Contact No: ${(s=o==null?void 0:o.customer)==null?void 0:s.phone}`}],u=[{value:` Invoice No: ${o==null?void 0:o.id}`},{value:`Invoice Date: ${P(o==null?void 0:o.date).format("YYYY-MM-DD")}`},{value:`currency : ${l}`}],j={jsPDF:{},tableFontSize:10,infoTopFontSize:10,bottomRightFontSize:10,bottomLeftFontSize:8,footerFontSize:10};return e.jsx("div",{className:"flex gap-2",children:e.jsx(O,{color:"primary",onClick:()=>W("print",{title:r,TopRightInfo:u,companyInfo:a,customerInfo:y,bottomLeftContent:i,bottomRightContent:m,tableBody:p,tableHead:h,settings:j,leftBottomSecondColumnX:45}),children:"Print"})})}function Ee({data:t,title:r}){var u,j,b,c;const{currencySymbol:o}=G()||{},l=T(d=>{var s;return(s=d==null?void 0:d.setting)==null?void 0:s.data})||null;S(),_(Math.round(t.totalAmount-t.discount)),Z(o);const a=[],n=[],i=["SI","Product Description","Quantity"],m=t.saleInvoiceProduct.map(d=>[d.id,d.product.name,d.productQuantity]),h=[{value:`Client Id: ${t==null?void 0:t.customerId}`},{value:`Client Name: ${(u=t==null?void 0:t.customer)==null?void 0:u.username}`},{value:`Address: ${(j=t==null?void 0:t.customer)!=null&&j.address?(b=t==null?void 0:t.customer)==null?void 0:b.address:""}`},{value:`Contact No: ${(c=t==null?void 0:t.customer)==null?void 0:c.phone}`}],p=[{value:` Invoice No: ${t==null?void 0:t.id}`},{value:`Invoice Date: ${P(t==null?void 0:t.date).format("YYYY-MM-DD")}`}],y={jsPDF:{},tableFontSize:10,infoTopFontSize:10,bottomRightFontSize:12,bottomLeftFontSize:8,footerFontSize:10};return e.jsx("div",{onClick:()=>W("print",{title:r,TopRightInfo:p,companyInfo:l,customerInfo:h,bottomLeftContent:a,bottomRightContent:n,tableBody:m,tableHead:i,settings:y}),children:"Print Packing Slip"})}const te=f.forwardRef(({data:t,invoiceData:r,vatAmount:o},l)=>{var a;return e.jsx(f.Fragment,{children:e.jsx("div",{ref:l,className:"pos",children:e.jsxs("div",{className:" font-sans text-black text-center flex flex-col items-center text-[15px]",children:[e.jsxs("div",{className:"",children:[e.jsx("h3",{className:"font-bold",children:r==null?void 0:r.companyName}),e.jsx("div",{className:"",children:r==null?void 0:r.tagLine}),e.jsxs("div",{className:"address",children:[r==null?void 0:r.address," ",e.jsx("br",{})," ",r==null?void 0:r.phone]}),e.jsx("div",{className:"email",children:r==null?void 0:r.email}),e.jsxs("div",{className:"website",children:[r==null?void 0:r.website," "]}),e.jsxs("div",{className:"bill-details",children:[e.jsx("div",{className:"flex justify-content-center",children:e.jsxs("div",{children:["BILL NO: ",t==null?void 0:t.saleInvoiceProduct[0].invoiceId]})}),e.jsx("div",{className:"flex justify-content-center",children:e.jsxs("div",{children:["BILL DATE: ",P(t==null?void 0:t.date).format("YYYY-MM-DD")]})})]})]}),e.jsxs("table",{className:"table",children:[e.jsxs("tr",{className:"header",children:[e.jsx("th",{children:"Particulars"})," ",e.jsx("th",{children:"Rate"})," ",e.jsx("th",{children:"Qty"}),e.jsx("th",{children:"Amount"})]}),t&&t.saleInvoiceProduct.map(n=>e.jsxs("tr",{className:"data",children:[e.jsx("td",{children:n.product.name}),e.jsx("td",{children:n.productUnitSalePrice}),e.jsx("td",{children:n.productQuantity}),e.jsx("td",{children:n.productQuantity*n.productUnitSalePrice})]},n.id)),e.jsxs("tr",{className:"subtotal border-t-2 border-dotted pt-1",children:[e.jsx("td",{}),e.jsx("td",{children:"Total"}),e.jsx("td",{children:(a=t.saleInvoiceProduct)==null?void 0:a.reduce((n,i)=>n+i.productQuantity,0)}),e.jsx("td",{children:t.totalAmount})]}),e.jsxs("tr",{className:"vat",children:[e.jsx("td",{}),e.jsx("td",{children:"Vat/Tax"}),e.jsx("td",{}),e.jsx("td",{children:t.totalTaxAmount})]}),e.jsxs("tr",{className:"subTotal",children:[e.jsx("td",{}),e.jsx("td",{children:"Sub Total"}),e.jsx("td",{}),e.jsx("td",{children:t.totalAmount+t.totalTaxAmount})]}),e.jsxs("tr",{className:"discount",children:[e.jsx("td",{}),e.jsx("td",{children:"Discount(-)"}),e.jsx("td",{}),e.jsx("td",{children:t.totalDiscountAmount})]}),e.jsxs("tr",{className:"total",children:[e.jsx("td",{children:" "}),e.jsx("td",{children:"Grand Total"}),e.jsx("td",{}),e.jsx("td",{children:t.totalAmount+t.totalTaxAmount-t.totalDiscountAmount})]})]}),e.jsx("div",{className:"text-center mt-4",children:e.jsxs("p",{className:"",children:[e.jsx("span",{className:"font-semibold",children:"Terms and Conditions:"})," ",t==null?void 0:t.termsAndConditions]})}),e.jsx("div",{className:"text-center mt-4",dangerouslySetInnerHTML:{__html:r==null?void 0:r.footer}})]})})})});te.displayName="printToPdf";const ze=({data:t,vatAmount:r})=>{const o=S(),l=f.useRef(),a=be.useReactToPrint({content:()=>l.current}),n=T(i=>{var m;return(m=i==null?void 0:i.setting)==null?void 0:m.data})||null;return f.useEffect(()=>{!n&&o(U())},[o,n]),e.jsxs("div",{children:[e.jsx("div",{className:"hidden",children:e.jsx(te,{ref:l,data:t,invoiceData:n,vatAmount:r})}),n&&e.jsx("div",{onClick:a,children:"POS Print"})]})};function Ye(t){return e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"loading",children:[e.jsx("p",{children:" Loading "}),e.jsx(ue,{size:"default"})]})})}const Qe=async({saleId:t,orderStatus:r})=>{try{return{response:await oe.patch("sale-invoice/order/",{invoiceId:t,orderStatus:r}),message:"success"}}catch{}},Ue=({saleId:t})=>{const{Option:r}=B,[o,l]=f.useState(!1),[a,n]=f.useState(!1),i=S();f.useEffect(()=>{n(!1)},[]);const m=()=>{l(!0)},h=()=>{l(!1)},p=()=>{l(!1)},y=async u=>{n(!0);const{message:j}=await Qe({saleId:t,orderStatus:u});j==="success"?(n(!1),K.success("Order Status Updated"),i(V(t)),l(!1)):(K.error("Something went wrong"),n(!1))};return e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:m,children:"Status"}),e.jsxs(Ce,{title:"Update Order Status",open:o,onOk:h,onCancel:p,children:[e.jsxs(v,{layout:"vertical",children:[e.jsxs("h1",{className:"text-lg text-center font-semibold text-gray-600",children:[" ","Order ID : ",t," "]}),e.jsx(v.Item,{label:"Update Order Status",children:e.jsxs(B,{placeholder:"Select Order Status",style:{width:"100%"},onChange:y,children:[e.jsx(r,{value:"pending",children:"Pending"}),e.jsx(r,{value:"received",children:"Received"})]})})]}),e.jsx(v.Item,{children:a&&e.jsx(Ye,{})})]})]})};function Ve(t,r,o,l){var b,c,d,s,x,A,I,w,$,F,D;const a=_(Math.round(t.totalAmount)),n=Z(l),i=[{label:"In Words: ",value:a||""},{label:"Terms And Conditions: ",value:t.termsAndConditions?t.termsAndConditions:""},{label:"Notes: ",value:t.note?t.note:""}],m=[{label:"Sub Total:",value:`${n} ${t.singleSaleInvoice.totalAmount}`},{label:"Discount: (-)",value:`${n} ${t.singleSaleInvoice.totalDiscountAmount?t.singleSaleInvoice.totalDiscountAmount:0}`},{label:"Tax: ",value:`${n} ${t.singleSaleInvoice.totalTaxAmount?t.singleSaleInvoice.totalTaxAmount:0}`},{label:"Grand total:",value:`${n} ${t.totalAmount-(t.discount?t.discount:0)}`},{label:"Paid:",value:`${n} ${t.totalPaidAmount}`},{label:"Due:",value:`${n} ${t.dueAmount}`}],h=["SI","Product Description","Quantity","Unit Price","Total Price","Tax"],p=t.singleSaleInvoice.saleInvoiceProduct.map(g=>[g.id,g.product.name,g.productQuantity,`${n} ${g.productUnitSalePrice}`,`${n} ${g.productUnitSalePrice*g.productQuantity}`,`${n} ${g.taxAmount?g.taxAmount:0}`]),y=[{value:`Client Id: ${(b=t==null?void 0:t.singleSaleInvoice)==null?void 0:b.customerId}`},{value:`Client Name: ${(d=(c=t==null?void 0:t.singleSaleInvoice)==null?void 0:c.customer)==null?void 0:d.username}`},{value:`Address: ${(x=(s=t==null?void 0:t.singleSaleInvoice)==null?void 0:s.customer)!=null&&x.address?(I=(A=t==null?void 0:t.singleSaleInvoice)==null?void 0:A.customer)==null?void 0:I.address:""}`},{value:`Contact No: ${($=(w=t==null?void 0:t.singleSaleInvoice)==null?void 0:w.customer)==null?void 0:$.phone}`}],u=[{value:` Invoice No: ${(F=t==null?void 0:t.singleSaleInvoice)==null?void 0:F.id}`},{value:`Invoice Date: ${P((D=t==null?void 0:t.singleSaleInvoice)==null?void 0:D.date).format("YYYY-MM-DD")}`}];return W(null,{title:o,TopRightInfo:u,customerInfo:y,companyInfo:r,bottomLeftContent:i,bottomRightContent:m,tableBody:p,tableHead:h,settings:{jsPDF:{},tableFontSize:10,infoTopFontSize:10,bottomRightFontSize:10,bottomLeftFontSize:7,footerFontSize:10},leftBottomSecondColumnX:28})}function qe({setSendEmail:t,modal:r,body:o,subject:l,customerEmail:a,onClose:n}){const[i]=v.useForm(),m=S(),[h,p]=f.useState(!1),[y,u]=f.useState([]),[j,b]=f.useState([]),[c,d]=f.useState([]),{sale:s,loading:x}=T(N=>N.sales),A=T(N=>{var C;return(C=N==null?void 0:N.setting)==null?void 0:C.data})||null,[I,w]=f.useState(o),{currencySymbol:$}=G()||{},F=async N=>{p(!0);try{let C=new FormData;N.receiverEmail&&C.append("receiverEmail",N.receiverEmail),N.subject&&C.append("subject",N.subject),I&&C.append("body",I),y&&y.forEach(E=>{E.name==="Order Invoice.pdf"?C.append("files[]",E.originFileObj,"Order Invoice.pdf"):C.append("files[]",E.originFileObj)}),j.length>0&&C.append("cc[]",j),c.length>0&&C.append("bcc[]",c),(await m(ne(C))).payload.message==="success"&&(t(!1),p(!1),i.resetFields(),b([]),d([]),u(null),n&&n())}catch(C){console.log(C)}p(!1)},D=()=>{};f.useEffect(()=>{!A&&m(U())});const g=N=>{u(N.fileList)};f.useEffect(()=>{s&&A&&u(N=>N.some(C=>C.name==="OrderInvoice.pdf")?N:[...N,{name:"Order Invoice.pdf",originFileObj:Ve(s,A,"Sale Invoice",$)}])},[s,A,$]);const k=N=>{w(N)};return e.jsx(e.Fragment,{children:!x&&s&&e.jsxs("div",{className:"py-4 px-4 border-t",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{className:""}),!r&&e.jsx("button",{onClick:()=>t(!1),className:"bg-red-100 p-1 rounded text-red-500",children:e.jsx(fe,{size:20})})]}),e.jsxs(v,{onFinish:F,onFinishFailed:D,colon:!1,layout:"vertical",form:i,initialValues:{subject:l,body:o,receiverEmail:a},children:[e.jsx(v.Item,{style:{width:"100%"},label:"To",rules:[{required:!0,message:"Please input receiver email!"}],name:"receiverEmail",children:e.jsx(Q,{placeholder:"Receiver Email"})}),e.jsx(J,{bordered:!1,defaultActiveKey:["0"],expandIcon:({isActive:N})=>e.jsx(Te,{rotate:N?90:0}),className:"site-collapse-custom-collapse mb-4 ",children:e.jsxs(J.Panel,{header:"CC & BCC",children:[e.jsx(X,{label:"CC",tags:j,setTags:b}),e.jsx(X,{label:"BCC",tags:c,setTags:d})]},"1")}),e.jsx(v.Item,{style:{width:"100%"},label:"Subject",name:"subject",children:e.jsx(Q,{placeholder:"Subject"})}),e.jsx(v.Item,{label:"Attachment",children:e.jsxs(Pe,{name:"files",fileList:y,onChange:g,multiple:!0,beforeUpload:()=>!1,children:[e.jsx("div",{className:"ant-upload-drag-icon flex justify-center my-2",children:e.jsx(me,{size:30})}),e.jsx("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload"})]})}),e.jsx(v.Item,{style:{marginBottom:"25px"},label:"Body",children:e.jsx(Ie,{value:I,onChange:k,modules:Se,formats:$e})}),e.jsx(v.Item,{children:e.jsx(q,{loading:h,size:"large",htmlType:"submit",type:"primary",children:"Send"})})]})]})})}function He({totalCalculator:t,form:r,setNewDue:o}){const l=S(),{list:a,loading:n}=T(m=>m.accounts);f.useEffect(()=>{l(le())},[l]);const i=m=>{const p=(r.getFieldValue("paidAmount")||[]).reduce((y,u)=>y+((u==null?void 0:u.amount)||0),0);o(p),t&&t(m)};return e.jsx(v.List,{name:"paidAmount",children:(m,{add:h,remove:p})=>e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"bg-tableBg",children:m.map(({key:y,name:u,...j},b)=>e.jsx("div",{className:" py-1 ",children:e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx(v.Item,{...j,name:[u,"amount"],className:"mb-0",rules:[{required:!0,message:"Amount is required"}],children:e.jsx(ee,{className:"discountType",addonAfter:e.jsx(v.Item,{...j,name:[u,"paymentType"],noStyle:!0,rules:[{required:!0,message:"Payment type is required"}],children:e.jsx(B,{loading:n,size:"small",popupClassName:"min-w-[200px]",style:{width:100},placeholder:"Select Payment type",optionFilterProp:"children",filterOption:(c,d)=>d.children.includes(c),filterSort:(c,d)=>c.children.toLowerCase().localeCompare(d.children.toLowerCase()),children:a==null?void 0:a.map(c=>e.jsx(B.Option,{value:c.id,children:c.name},c.id))})}),placeholder:"0",style:{width:"100%"},size:"small",onChange:()=>i(b)})}),e.jsx("button",{shape:"circle",className:"flex justify-center items-center hover:bg-black/40 rounded-md",onClick:()=>{p(u),t&&t(b)},children:e.jsx(je,{size:25})})]})},y))}),e.jsx("div",{className:"flex items-center justify-center mt-2",children:e.jsx(q,{type:"dashed",size:"small",onClick:()=>h(),className:"flex items-center justify-center",block:!0,icon:e.jsx(re,{}),children:"Add Payment"})})]})})}const We=({data:t,onClose:r,singlePage:o})=>{const{singleSaleInvoice:l,dueAmount:a}=t,n=l==null?void 0:l.id,i=S(),{Title:m}=we,[h]=v.useForm();let[p,y]=f.useState(P());const[u,j]=f.useState(!1),[b,c]=f.useState(0),d=async x=>{j(!0);try{const A={date:p,saleInvoiceNo:parseInt(x.saleInvoiceNo),...x,paidAmount:x.paidAmount||[]};(await i(ae(A))).payload.message==="success"&&(j(!1),i(o?V(n):ie({page:1,count:10,status:"true",startDate:P().startOf("month").format("YYYY-MM-DD"),endDate:P().endOf("month").format("YYYY-MM-DD"),user:""})),r()),j(!1),h.resetFields()}catch{j(!1)}},s=x=>{j(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs(m,{level:4,className:"text-center",children:["Due Amount :"," ",e.jsx("strong",{style:{color:"red"},children:(a==null?void 0:a.toFixed(3))||0})]}),b?e.jsxs("p",{className:"text-center text-lg font-semibold",children:["Remaining Amount :"," ",e.jsx("strong",{style:{color:"red"},children:(a-b).toFixed(2)})]}):"",e.jsxs(v,{form:h,className:"m-4 px-7",name:"basic",layout:"vertical",initialValues:{remember:!0,saleInvoiceNo:n,discount:0,paidAmount:[{}]},onFinish:d,onFinishFailed:s,autoComplete:"off",children:[e.jsx(v.Item,{label:"Date",rules:[{required:!0,message:"Please input the date!"}],style:{marginBottom:"10px"},children:e.jsx(ke,{onChange:x=>y(x==null?void 0:x._d),defaultValue:De(),label:"date",name:"date",rules:[{required:!0,message:"Please input Date"}]})}),e.jsxs("div",{className:"mt-5",children:[e.jsxs("span",{children:["Paid Amount",a&&e.jsx("button",{type:"button",onClick:()=>{h.setFieldsValue({paidAmount:[{amount:a}]}),c(0)},className:"ml-3 bg-blue-200 rounded px-1",children:"Full Paid"})]}),e.jsx(He,{form:h,setNewDue:c})]}),e.jsx(v.Item,{style:{marginBottom:"10px",marginTop:"20px"},label:"Sale Invoice No",name:"saleInvoiceNo",validateStatus:"success",children:e.jsx(Q,{disabled:!0})}),e.jsx(v.Item,{style:{marginBottom:"10px"},wrapperCol:{offset:8,span:16},children:e.jsx(q,{className:"mt-5",block:!0,type:"primary",htmlType:"submit",shape:"round",loading:u,children:"Pay Now"})})]})]})};function _e(t){const r=P(t);if(P()>r)return"Overdue"}const Ge=()=>{var F,D;const{id:t}=ce(),[r,o]=f.useState(!1),[l,a]=f.useState(!1),n=T(g=>{var k;return(k=g==null?void 0:g.setting)==null?void 0:k.data})||null,i=S(),[m,h]=f.useState(!1),p=T(g=>{var k;return(k=g==null?void 0:g.sales)==null?void 0:k.sale}),{status:y,totalPaidAmount:u,totalVatAmount:j,totalReturnAmount:b,instantPaidReturnAmount:c,dueAmount:d,singleSaleInvoice:s,returnSaleInvoice:x,transactions:A}=p||{};f.useEffect(()=>(i(V(t)),()=>{i(de())}),[t,i]);const I=(F=s==null?void 0:s.customer)==null?void 0:F.email,w=`Your order has been placed. Order ID #${s==null?void 0:s.id}`,$=`
<div>Dear <strong>${(D=s==null?void 0:s.customer)==null?void 0:D.username}</strong>,</div>
<div>Greetings! We trust this message reaches you in great spirits. We are immensely grateful for the privilege of having you as our esteemed customer.</div>
<br>
<strong>Order Information:</strong><br>
<p>Order ID: ${s==null?void 0:s.id}</p>
<p>Order Date: ${P(s==null?void 0:s.date).format("ll")}</p>
<br>
<strong>Invoice Details:</strong><br>
<p>Total Amount: $${s!=null&&s.totalAmount?Number(s.totalAmount+((s==null?void 0:s.totalDiscountAmount)||0)).toFixed(2):0} </p>
<p>Discount: $${s!=null&&s.totalDiscountAmount?Number(s.totalDiscountAmount).toFixed(2):0} </p>
<p>
Tax: $${s!=null&&s.totalTaxAmount?Number(s.totalTaxAmount).toFixed(2):0} </p>
<p>Paid Amount: $${u?Number(u).toFixed(2):0}</p>
<p>Due Amount: $${d?Number(d).toFixed(2):0}</p>
<br>
<p>Best Regards,</p>
<p>${n==null?void 0:n.companyName}</p>
<p>${n==null?void 0:n.phone}</p>
<p>${n==null?void 0:n.email}</p>`;return f.useEffect(()=>{!n&&i(U())},[i,n]),e.jsxs(e.Fragment,{children:[s?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex gap-2 md:gap-4",children:[e.jsxs(R,{className:"w-2/3",bodyClass:"p-0",children:[e.jsx("div",{className:"flex justify-between mx-2 py-2 border-b items-center",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"text-end ",children:s&&e.jsx(Be,{sale:p,title:"Sale Invoice"})}),e.jsx(O,{className:"flex-row-reverse",color:"gray",icon:e.jsx(xe,{size:15}),onClick:()=>o(!0),children:"Send"}),e.jsx(Re,{content:e.jsx(pe,{items:[{label:e.jsx(e.Fragment,{children:e.jsx("span",{onClick:()=>{h({singleSaleInvoice:s,dueAmount:d})},children:e.jsx("button",{className:"flex items-center gap-2 rounded disabled:cursor-not-allowed disabled:opacity-50 py-1",disabled:(p==null?void 0:p.dueAmount)<=0,children:"Make a payment"})})}),key:"edit"},{key:"status",label:e.jsx(Ue,{saleId:s.id})},{key:"2",label:e.jsx(M,{to:`/admin/sale/return/${t}`,children:"Return"})},{key:"3",label:s&&e.jsx(Ee,{title:"packing slip",data:s})},{key:"4",label:e.jsx(ze,{data:s,vatAmount:j})}]}),placement:"bottomRight",arrow:!1,trigger:"click",children:e.jsx(O,{color:"gray",icon:e.jsx(he,{size:15}),className:"  px-3"})})]})}),r?e.jsx("div",{children:e.jsx(qe,{body:$,subject:w,setSendEmail:o,customerEmail:I})}):e.jsxs(ye,{className:"mt-4",children:[e.jsx(Y,{label:"Products",children:e.jsx(Oe,{list:s.saleInvoiceProduct})}),e.jsx(Y,{label:"Return products",children:e.jsx(Le,{list:x})}),e.jsx(Y,{label:"Transactions",children:e.jsx(Me,{list:A})})]})]}),e.jsxs("div",{className:"w-1/3 flex flex-col gap-2 md:gap-4",children:[e.jsx(R,{title:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"font-normal",children:["Invoice No"," ",e.jsxs("span",{className:"font-semibold",children:["#",s.id]})]})}),children:e.jsx(e.Fragment,{children:e.jsx(L,{labelClassName:"w-[40%]",list:[{label:"Invoice Date",value:P(s.createdAt).format("ll")},{label:"Due Date",value:s.dueDate?e.jsxs("div",{className:"flex gap-1 items-center",children:[P(s.dueDate).format("ll"),_e(s.dueDate)&&e.jsx(z,{className:"text-xs",color:"red",children:"Overdue"})]}):"N/A"},{label:"Delivery",value:e.jsx(z,{color:s.orderStatus==="RECEIVED"?"success":"orange",children:s.orderStatus})},{label:"Payment",value:e.jsx(z,{color:y==="PAID"?"green":"red",children:y})}]})})}),e.jsx(R,{title:"Payment Details",children:e.jsx(L,{labelClassName:"w-[40%]",list:[{label:"Profit",value:s!=null&&s.profit?Number(s.profit).toFixed(2):0,className:"border-b pb-2",valueClass:(s==null?void 0:s.profit)<0?"text-red-500 font-bold":"text-green-500 font-bold"},{label:"Total Amount",value:s!=null&&s.totalAmount?Number(s.totalAmount+((s==null?void 0:s.totalDiscountAmount)||0)).toFixed(2):0},{label:"Discount",value:e.jsx("div",{className:"before:content-['-'] relative before:absolute before:text-red-500 before:font-bold before:-left-3 before:top-0",children:s!=null&&s.totalDiscountAmount?Number(s.totalDiscountAmount).toFixed(2):0}),hidden:(s==null?void 0:s.totalDiscountAmount)===0},{label:"Total Tax",value:e.jsx("div",{className:"before:content-['+'] relative before:absolute before:text-green-500 before:font-bold before:-left-3 before:top-0",children:s!=null&&s.totalTaxAmount?Number(s.totalTaxAmount).toFixed(2):0}),hidden:(s==null?void 0:s.totalTaxAmount)===0},{label:"Return Product Value",value:e.jsx("div",{className:"before:content-['-'] relative before:absolute before:text-red-500 before:font-bold before:-left-3 before:top-0",children:b?Number(b).toFixed(2):0}),hidden:b===0&&c===0},{label:"Return Amount",value:e.jsxs("div",{className:"before:content-['+'] relative before:absolute before:text-green-500 before:font-bold before:-left-3 before:top-0",children:[c?Number(c).toFixed(2):0,b!=c&&e.jsx(O,{onClick:()=>a(!0),className:"absolute right-4 -top-[23px] inline-block w-auto min-w-[100px] border-blue-400 border-[1.5px] rounded px-3",children:"Make Refund"})]}),hidden:b===0&&c===0},{label:"Total Paid Amount",value:e.jsx("div",{className:"before:content-['-'] relative before:absolute before:text-red-500 before:font-bold before:-left-3 before:top-0",children:u?Number(u).toFixed(2):0}),className:"border-b pb-1"},{label:"Due Amount",value:d?Number(d).toFixed(2):0}]})}),e.jsx(R,{title:"Customer Details",children:e.jsx(L,{labelClassName:"w-[40%]",list:[{label:"Name",value:e.jsx(M,{to:`/admin/customer/${s.customer.id}`,children:s.customer.username})},{label:"Phone",value:s.customer.phone},{label:"Email",value:s.customer.email||"N/A"},{label:"Address",value:s.customer.address}]})}),e.jsx(R,{children:e.jsx(L,{labelClassName:"w-[40%] font-bold",list:[{label:"Note",value:s.note,className:"flex-col gap-1"},{label:"Terms and Conditions",value:s.termsAndConditions,className:"flex-col gap-1"}]})})]})]})}):e.jsx(Ne,{}),e.jsx(ge,{title:"Make Refund",width:"40%",onClose:()=>a(!1),open:l,bodyStyle:{paddingBottom:80},children:e.jsx(Ae,{dueAmount:Math.abs(d),isSale:!0,id:t,preFieldValue:{relatedId:s==null?void 0:s.id,type:"sale_return"}})}),e.jsx(Fe,{outsideClick:!0,open:m,title:"Make Purchase",className:"bg-white",onClose:()=>h(!1),children:e.jsx(We,{singlePage:!0,data:m,onClose:()=>h(!1)})})]})},yt=Ge;export{yt as D,Oe as S,qe as a,We as b,_e as d};
